{% extends "base.html" %}

{% block title %}Bulk Import Inventory - Spa & Salon Management Suite{% endblock %}

{% block content %}
<div class="container-fluid px-4 py-1">
    <!-- Header Section -->
    <div class="row g-4 mb-4">
        <div class="col-12">
            <div class="bg-white rounded-3 shadow-sm border-0 p-4">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <div class="d-flex align-items-center mb-2">
                            <div class="icon-wrapper me-3">
                                <i class="fas fa-file-upload text-success fs-2"></i>
                            </div>
                            <div>
                                <h1 class="h2 mb-1 text-dark fw-bold">Bulk Import Inventory</h1>
                                <p class="text-muted mb-0 fs-6">Import multiple inventory items from Excel spreadsheet</p>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex gap-3 flex-shrink-0">
                        <a href="{{ url_for('inventory') }}" class="btn btn-outline-secondary px-4 py-2 fw-semibold">
                            <i class="fas fa-arrow-left me-2"></i>Back to Inventory
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <!-- Import Instructions -->
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-transparent border-0 pb-0">
                    <h5 class="card-title mb-0 fw-bold text-dark">
                        <i class="fas fa-info-circle text-info me-2"></i>How to Import Inventory
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-4">
                        <h6 class="fw-bold text-dark mb-3">Step 1: Download Template</h6>
                        <p class="text-muted mb-3">Download our Excel template with sample data and field descriptions to ensure proper formatting.</p>
                        <a href="{{ url_for('download_inventory_template') }}" class="btn btn-success px-4 py-2">
                            <i class="fas fa-download me-2"></i>Download Excel Template
                        </a>
                    </div>

                    <div class="mb-4">
                        <h6 class="fw-bold text-dark mb-3">Step 2: Fill Your Data</h6>
                        <p class="text-muted mb-2">Fill in your inventory data following the template format. Required fields are:</p>
                        <ul class="text-muted small">
                            <li><strong>name</strong> - Product name (e.g., "Face Cream Premium")</li>
                            <li><strong>sku</strong> - Unique product code (e.g., "FC001")</li>
                            <li><strong>category</strong> - Category name (e.g., "skincare", "haircare")</li>
                            <li><strong>current_stock</strong> - Current stock quantity</li>
                            <li><strong>cost_price</strong> - Cost price per unit</li>
                        </ul>
                    </div>

                    <div class="mb-4">
                        <h6 class="fw-bold text-dark mb-3">Step 3: Upload File</h6>
                        <p class="text-muted mb-2">Upload your completed Excel file using the form on the right. The system will:</p>
                        <ul class="text-muted small">
                            <li>Validate all required fields</li>
                            <li>Check for duplicate SKU codes</li>
                            <li>Create categories automatically if they don't exist</li>
                            <li>Provide detailed success/error reports</li>
                        </ul>
                    </div>

                    <div class="alert alert-warning border-0" role="alert">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Important:</strong> Make sure SKU codes are unique. Duplicate SKUs will be skipped during import.
                    </div>
                </div>
            </div>
        </div>

        <!-- Upload Form -->
        <div class="col-lg-4">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-transparent border-0 pb-0">
                    <h5 class="card-title mb-0 fw-bold text-dark">
                        <i class="fas fa-upload text-primary me-2"></i>Upload Excel File
                    </h5>
                </div>
                <div class="card-body">
                    <form method="POST" enctype="multipart/form-data" id="importForm">
                        <div class="mb-3">
                            <label for="inventory_file" class="form-label fw-semibold text-dark">Select Excel File</label>
                            <input type="file" 
                                   class="form-control form-control-lg" 
                                   id="inventory_file" 
                                   name="inventory_file" 
                                   accept=".xlsx,.xls"
                                   required>
                            <div class="form-text text-muted">
                                <i class="fas fa-file-excel me-1"></i>Supported formats: .xlsx, .xls
                            </div>
                        </div>

                        <div class="d-grid mb-3">
                            <button type="submit" class="btn btn-primary btn-lg fw-semibold" id="submitBtn">
                                <i class="fas fa-upload me-2"></i>Import Inventory
                            </button>
                        </div>

                        <div class="text-center">
                            <small class="text-muted">
                                <i class="fas fa-shield-alt me-1"></i>
                                Your data is processed securely and locally
                            </small>
                        </div>
                    </form>

                    <!-- Progress indicator (hidden by default) -->
                    <div id="progressSection" class="mt-4" style="display: none;">
                        <div class="text-center mb-3">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                        <p class="text-center text-muted small mb-0">Processing your file...</p>
                    </div>
                </div>
            </div>

            <!-- Sample Data Preview -->
            <div class="card border-0 shadow-sm mt-4">
                <div class="card-header bg-transparent border-0 pb-0">
                    <h6 class="card-title mb-0 fw-bold text-dark">
                        <i class="fas fa-eye text-info me-2"></i>Sample Data Format
                    </h6>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-sm table-bordered">
                            <thead class="table-light">
                                <tr>
                                    <th style="font-size: 0.75rem;">name</th>
                                    <th style="font-size: 0.75rem;">sku</th>
                                    <th style="font-size: 0.75rem;">category</th>
                                    <th style="font-size: 0.75rem;">stock</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr style="font-size: 0.7rem;">
                                    <td>Face Cream</td>
                                    <td>FC001</td>
                                    <td>skincare</td>
                                    <td>25</td>
                                </tr>
                                <tr style="font-size: 0.7rem;">
                                    <td>Hair Shampoo</td>
                                    <td>HS002</td>
                                    <td>haircare</td>
                                    <td>15</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <p class="text-muted small mb-0">
                        <i class="fas fa-info-circle me-1"></i>
                        This shows the minimum required columns. Download the template for all available fields.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('importForm').addEventListener('submit', function(e) {
    const fileInput = document.getElementById('inventory_file');
    const submitBtn = document.getElementById('submitBtn');
    const progressSection = document.getElementById('progressSection');
    
    if (fileInput.files.length === 0) {
        e.preventDefault();
        alert('Please select a file to upload');
        return;
    }
    
    // Show progress indicator
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Processing...';
    progressSection.style.display = 'block';
});

// File input validation
document.getElementById('inventory_file').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        const validTypes = ['application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 'application/vnd.ms-excel'];
        if (!validTypes.includes(file.type) && !file.name.toLowerCase().endsWith('.xlsx') && !file.name.toLowerCase().endsWith('.xls')) {
            alert('Please select a valid Excel file (.xlsx or .xls)');
            e.target.value = '';
            return;
        }
        
        // Show file size
        const fileSize = (file.size / 1024 / 1024).toFixed(2);
        console.log(`Selected file: ${file.name} (${fileSize} MB)`);
    }
});
</script>
{% endblock %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schedule Management</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .schedule-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .schedule-grid {
            display: grid;
            grid-template-columns: 200px repeat(8, 1fr);
            border: 1px solid #dee2e6;
        }

        .time-header, .staff-cell, .time-slot {
            border: 1px solid #dee2e6;
            padding: 12px 8px;
            text-align: center;
            position: relative;
        }

        .time-header {
            background: #f8f9fa;
            font-weight: 600;
            font-size: 14px;
            color: #495057;
        }

        .staff-cell {
            background: #f8f9fa;
            text-align: left;
            font-weight: 600;
            border-right: 2px solid #dee2e6;
        }

        .staff-name {
            font-size: 15px;
            color: #212529;
            margin-bottom: 2px;
        }

        .staff-role {
            font-size: 12px;
            color: #6c757d;
            font-weight: normal;
        }

        .time-slot {
            min-height: 60px;
            background: white;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .time-slot:hover {
            background: #f8f9fa;
        }

        .appointment-block {
            position: absolute;
            top: 2px;
            left: 2px;
            right: 2px;
            bottom: 2px;
            background: #2563eb;
            color: white;
            border-radius: 4px;
            padding: 6px 8px;
            font-size: 12px;
            line-height: 1.3;
            overflow: hidden;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .appointment-client {
            font-weight: 600;
            margin-bottom: 2px;
        }

        .appointment-service {
            font-size: 11px;
            opacity: 0.9;
        }

        .break-block {
            position: absolute;
            top: 2px;
            left: 2px;
            right: 2px;
            bottom: 2px;
            background: #f59e0b;
            color: white;
            border-radius: 4px;
            padding: 6px 8px;
            font-size: 12px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            cursor: default;
        }

        .drag-selection {
            position: absolute;
            background: rgba(37, 99, 235, 0.2);
            border: 2px dashed #2563eb;
            border-radius: 4px;
            z-index: 100;
            pointer-events: none;
        }

        .header-controls {
            padding: 20px;
            border-bottom: 1px solid #dee2e6;
            background: white;
        }

        .btn-primary {
            background-color: #2563eb;
            border-color: #2563eb;
        }

        .btn-primary:hover {
            background-color: #1d4ed8;
            border-color: #1d4ed8;
        }

        .modal-header {
            background-color: #2563eb;
            color: white;
        }

        .form-label {
            font-weight: 600;
            color: #374151;
        }

        .stats-row {
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: 700;
            color: #2563eb;
        }

        .stat-label {
            font-size: 12px;
            color: #6c757d;
            text-transform: uppercase;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container-fluid py-4">
        <div class="row">
            <div class="col-12">
                <div class="schedule-container">
                    <!-- Header Controls -->
                    <div class="header-controls">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <h2 class="h4 mb-0">
                                    <i class="fas fa-calendar-alt me-2"></i>
                                    Schedule Management
                                </h2>
                                <p class="text-muted mb-0 mt-1">Drag to select time slots and create appointments</p>
                            </div>
                            <div class="col-md-6 text-end">
                                <div class="row g-2">
                                    <div class="col-auto">
                                        <label class="form-label mb-1 d-block text-start">Date:</label>
                                        <input type="date" id="scheduleDate" class="form-control" onchange="loadScheduleForDate()">
                                    </div>
                                    <div class="col-auto d-flex align-items-end">
                                        <button class="btn btn-outline-secondary me-2" onclick="refreshSchedule()">
                                            <i class="fas fa-sync-alt"></i>
                                        </button>
                                        <button class="btn btn-primary" onclick="loadSampleData()">
                                            Load Demo Data
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Stats Row -->
                    <div class="stats-row">
                        <div class="row">
                            <div class="col-3">
                                <div class="stat-item">
                                    <div class="stat-number" id="totalAppointments">0</div>
                                    <div class="stat-label">Appointments</div>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="stat-item">
                                    <div class="stat-number" id="activeStaff">0</div>
                                    <div class="stat-label">Staff on Duty</div>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="stat-item">
                                    <div class="stat-number" id="availableSlots">0</div>
                                    <div class="stat-label">Available Slots</div>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="stat-item">
                                    <div class="stat-number" id="utilizationRate">0%</div>
                                    <div class="stat-label">Utilization</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Schedule Grid -->
                    <div id="scheduleGrid" class="schedule-grid">
                        <!-- Grid content will be generated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Booking Modal -->
    <div class="modal fade" id="bookingModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-calendar-plus me-2"></i>
                        New Appointment
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="bookingForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Client Name *</label>
                                    <input type="text" id="clientName" class="form-control" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Phone</label>
                                    <input type="tel" id="clientPhone" class="form-control">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Service *</label>
                                    <select id="serviceType" class="form-select" required>
                                        <option value="">Select Service</option>
                                        <option value="Deep Cleansing Facial">Deep Cleansing Facial</option>
                                        <option value="Swedish Massage">Swedish Massage</option>
                                        <option value="Hair Cut & Style">Hair Cut & Style</option>
                                        <option value="Classic Manicure">Classic Manicure</option>
                                        <option value="Pedicure">Pedicure</option>
                                        <option value="Waxing">Waxing</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Staff *</label>
                                    <select id="staffSelect" class="form-select" required></select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Start Time *</label>
                                    <input type="time" id="startTime" class="form-control" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Duration *</label>
                                    <select id="appointmentDuration" class="form-select" required onchange="updateEndTime()">
                                        <option value="30">30 minutes</option>
                                        <option value="45">45 minutes</option>
                                        <option value="60" selected>1 hour</option>
                                        <option value="90">1 hour 30 minutes</option>
                                        <option value="120">2 hours</option>
                                        <option value="150">2 hours 30 minutes</option>
                                        <option value="180">3 hours</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">End Time *</label>
                                    <input type="time" id="endTime" class="form-control" required readonly>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Notes</label>
                            <textarea id="appointmentNotes" class="form-control" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="bookAppointment()">Book Appointment</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        let scheduleData = {
            staff: [],
            appointments: [],
            breaks: []
        };

        let isDragging = false;
        let dragStart = null;
        let dragSelection = null;
        let currentDate = new Date().toISOString().split('T')[0];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('scheduleDate').value = currentDate;
            loadScheduleForDate();
            
            // Add event listener for start time changes
            document.getElementById('startTime').addEventListener('change', updateEndTime);
        });

        function generateTimeSlots() {
            const slots = [];
            for (let hour = 8; hour < 16; hour++) {
                const timeStr = `${hour.toString().padStart(2, '0')}:00`;
                let displayTime = hour <= 12 ? `${hour}:00 AM` : `${hour - 12}:00 PM`;
                if (hour === 12) displayTime = '12:00 PM';
                slots.push({ time: timeStr, display: displayTime });
            }
            return slots;
        }

        function loadScheduleForDate() {
            currentDate = document.getElementById('scheduleDate').value;
            
            // Try to load from localStorage or API
            const localData = localStorage.getItem(`schedule-${currentDate}`);
            if (localData) {
                scheduleData = JSON.parse(localData);
                renderSchedule();
                updateStats();
            } else {
                // Load empty schedule
                scheduleData = { staff: [], appointments: [], breaks: [] };
                renderSchedule();
                updateStats();
            }
        }

        function loadSampleData() {
            scheduleData = {
                staff: [
                    { id: 1, name: 'Sarah Johnson', role: 'Facial Specialist' },
                    { id: 2, name: 'Michael Chen', role: 'Massage Therapist' },
                    { id: 3, name: 'Emily Rodriguez', role: 'Hair Stylist' },
                    { id: 4, name: 'James Wilson', role: 'Nail Technician' },
                    { id: 5, name: 'Linda Davis', role: 'Makeup Artist' }
                ],
                appointments: [
                    // 1.5 hour appointments
                    { id: 1, staffId: 1, clientName: 'Jessica Brown', service: 'Deep Cleansing Facial', startTime: '09:00', endTime: '10:30', duration: 90 },
                    { id: 2, staffId: 2, clientName: 'Amanda White', service: 'Hot Stone Massage', startTime: '08:30', endTime: '10:00', duration: 90 },
                    { id: 3, staffId: 5, clientName: 'Linda Anderson', service: 'Hair Cut & Color', startTime: '10:30', endTime: '12:00', duration: 90 },
                    
                    // 2 hour appointments
                    { id: 4, staffId: 3, clientName: 'Maria Garcia', service: 'Full Hair Treatment', startTime: '13:00', endTime: '15:00', duration: 120 },
                    { id: 5, staffId: 1, clientName: 'Emma Thompson', service: 'Premium Facial Package', startTime: '11:00', endTime: '13:00', duration: 120 },
                    
                    // 45 minute appointments
                    { id: 6, staffId: 4, clientName: 'Robert Taylor', service: 'Express Manicure', startTime: '09:00', endTime: '09:45', duration: 45 },
                    { id: 7, staffId: 4, clientName: 'Sophie Miller', service: 'Quick Pedicure', startTime: '10:15', endTime: '11:00', duration: 45 },
                    
                    // 30 minute appointments
                    { id: 8, staffId: 2, clientName: 'David Brown', service: 'Consultation', startTime: '11:00', endTime: '11:30', duration: 30 },
                    { id: 9, staffId: 5, clientName: 'Kate Wilson', service: 'Eyebrow Shaping', startTime: '14:00', endTime: '14:30', duration: 30 }
                ],
                breaks: [
                    { id: 1, staffId: 2, startTime: '12:00', endTime: '12:30', reason: 'Lunch Break' },
                    { id: 2, staffId: 4, startTime: '14:00', endTime: '14:15', reason: 'Coffee Break' },
                    { id: 3, staffId: 1, startTime: '13:30', endTime: '14:00', reason: 'Lunch Break' },
                    { id: 4, staffId: 3, startTime: '12:00', endTime: '13:00', reason: 'Lunch Hour' }
                ]
            };

            // Save to localStorage
            localStorage.setItem(`schedule-${currentDate}`, JSON.stringify(scheduleData));
            
            renderSchedule();
            updateStats();
        }

        function renderSchedule() {
            const grid = document.getElementById('scheduleGrid');
            const timeSlots = generateTimeSlots();
            
            // Clear grid
            grid.innerHTML = '';
            
            // Create header row
            const emptyCorner = document.createElement('div');
            emptyCorner.className = 'time-header';
            emptyCorner.innerHTML = '<strong>Staff</strong>';
            grid.appendChild(emptyCorner);

            timeSlots.forEach(slot => {
                const timeHeader = document.createElement('div');
                timeHeader.className = 'time-header';
                timeHeader.textContent = slot.display;
                grid.appendChild(timeHeader);
            });

            // Create staff rows
            scheduleData.staff.forEach(staff => {
                // Staff name cell
                const staffCell = document.createElement('div');
                staffCell.className = 'staff-cell';
                staffCell.innerHTML = `
                    <div class="staff-name">${staff.name}</div>
                    <div class="staff-role">${staff.role}</div>
                `;
                grid.appendChild(staffCell);

                // Time slots for this staff member
                timeSlots.forEach((slot, slotIndex) => {
                    const timeSlot = document.createElement('div');
                    timeSlot.className = 'time-slot';
                    timeSlot.dataset.staffId = staff.id;
                    timeSlot.dataset.time = slot.time;
                    
                    // Check for appointments that start at this time
                    const appointment = scheduleData.appointments.find(apt => 
                        apt.staffId === staff.id && apt.startTime === slot.time
                    );
                    
                    // Check if this slot is occupied by an ongoing appointment
                    const ongoingAppointment = scheduleData.appointments.find(apt => {
                        if (apt.staffId !== staff.id) return false;
                        
                        const aptStartHour = parseInt(apt.startTime.split(':')[0]);
                        const aptStartMinute = parseInt(apt.startTime.split(':')[1]);
                        const aptEndHour = parseInt(apt.endTime.split(':')[0]);
                        const aptEndMinute = parseInt(apt.endTime.split(':')[1]);
                        
                        const slotHour = parseInt(slot.time.split(':')[0]);
                        const slotMinute = parseInt(slot.time.split(':')[1]);
                        
                        const aptStartTime = aptStartHour * 60 + aptStartMinute;
                        const aptEndTime = aptEndHour * 60 + aptEndMinute;
                        const slotTime = slotHour * 60 + slotMinute;
                        
                        return slotTime >= aptStartTime && slotTime < aptEndTime;
                    });
                    
                    // Check for breaks
                    const breakItem = scheduleData.breaks.find(brk => 
                        brk.staffId === staff.id && brk.startTime === slot.time
                    );

                    if (appointment) {
                        // Calculate span based on duration
                        const duration = appointment.duration || 60;
                        const durationText = duration >= 60 ? 
                            `${Math.floor(duration / 60)}h ${duration % 60 > 0 ? duration % 60 + 'm' : ''}`.trim() :
                            `${duration}m`;
                        
                        timeSlot.innerHTML = `
                            <div class="appointment-block">
                                <div class="appointment-client">${appointment.clientName}</div>
                                <div class="appointment-service">${appointment.service}</div>
                                <div class="appointment-duration" style="font-size: 10px; opacity: 0.8;">${durationText}</div>
                            </div>
                        `;
                    } else if (ongoingAppointment && !appointment) {
                        // This slot is part of an ongoing appointment
                        timeSlot.innerHTML = `
                            <div class="appointment-block" style="background: #1d4ed8; opacity: 0.8;">
                                <div class="appointment-client" style="font-size: 10px;">↑ ${ongoingAppointment.clientName}</div>
                            </div>
                        `;
                    } else if (breakItem) {
                        timeSlot.innerHTML = `
                            <div class="break-block">
                                <i class="fas fa-coffee me-1"></i>Break
                            </div>
                        `;
                    }
                    
                    grid.appendChild(timeSlot);
                });
            });

            setupDragHandlers();
        }

        function setupDragHandlers() {
            const timeSlots = document.querySelectorAll('.time-slot');
            
            timeSlots.forEach(slot => {
                slot.addEventListener('mousedown', handleMouseDown);
                slot.addEventListener('mouseenter', handleMouseEnter);
                slot.addEventListener('mouseup', handleMouseUp);
            });
        }

        function handleMouseDown(e) {
            if (e.target.closest('.appointment-block, .break-block')) return;
            
            isDragging = true;
            dragStart = {
                staffId: parseInt(e.currentTarget.dataset.staffId),
                time: e.currentTarget.dataset.time,
                element: e.currentTarget
            };
            
            e.currentTarget.style.background = 'rgba(37, 99, 235, 0.1)';
        }

        function handleMouseEnter(e) {
            if (!isDragging) return;
            
            const currentStaffId = parseInt(e.currentTarget.dataset.staffId);
            if (currentStaffId !== dragStart.staffId) return;
            
            // Highlight selection
            e.currentTarget.style.background = 'rgba(37, 99, 235, 0.1)';
        }

        function handleMouseUp(e) {
            if (!isDragging) return;
            
            isDragging = false;
            
            const endTime = e.currentTarget.dataset.time;
            const staffId = dragStart.staffId;
            
            // Clear highlights
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.style.background = '';
            });
            
            if (staffId && dragStart.time && endTime) {
                openBookingModal(staffId, dragStart.time, endTime);
            }
        }

        function openBookingModal(staffId, startTime, endTime) {
            const staff = scheduleData.staff.find(s => s.id === staffId);
            if (!staff) return;

            document.getElementById('startTime').value = startTime;
            document.getElementById('endTime').value = endTime;
            
            // Populate staff select
            const staffSelect = document.getElementById('staffSelect');
            staffSelect.innerHTML = '';
            scheduleData.staff.forEach(s => {
                const option = document.createElement('option');
                option.value = s.id;
                option.textContent = `${s.name} (${s.role})`;
                option.selected = s.id === staffId;
                staffSelect.appendChild(option);
            });

            const modal = new bootstrap.Modal(document.getElementById('bookingModal'));
            modal.show();
        }

        function updateEndTime() {
            const startTime = document.getElementById('startTime').value;
            const duration = parseInt(document.getElementById('appointmentDuration').value);
            
            if (startTime) {
                const [hours, minutes] = startTime.split(':').map(Number);
                const startMinutes = hours * 60 + minutes;
                const endMinutes = startMinutes + duration;
                
                const endHours = Math.floor(endMinutes / 60);
                const endMins = endMinutes % 60;
                
                const endTime = `${endHours.toString().padStart(2, '0')}:${endMins.toString().padStart(2, '0')}`;
                document.getElementById('endTime').value = endTime;
            }
        }

        function bookAppointment() {
            const form = document.getElementById('bookingForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const duration = parseInt(document.getElementById('appointmentDuration').value);
            
            const newAppointment = {
                id: Date.now(),
                staffId: parseInt(document.getElementById('staffSelect').value),
                clientName: document.getElementById('clientName').value,
                service: document.getElementById('serviceType').value,
                startTime: document.getElementById('startTime').value,
                endTime: document.getElementById('endTime').value,
                duration: duration,
                phone: document.getElementById('clientPhone').value,
                notes: document.getElementById('appointmentNotes').value
            };

            scheduleData.appointments.push(newAppointment);
            localStorage.setItem(`schedule-${currentDate}`, JSON.stringify(scheduleData));
            
            // Clear form
            form.reset();
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('bookingModal'));
            modal.hide();
            
            renderSchedule();
            updateStats();
        }

        function updateStats() {
            document.getElementById('totalAppointments').textContent = scheduleData.appointments.length;
            document.getElementById('activeStaff').textContent = scheduleData.staff.length;
            
            const totalSlots = scheduleData.staff.length * 8; // 8 time slots per staff
            const bookedSlots = scheduleData.appointments.length + scheduleData.breaks.length;
            const availableSlots = Math.max(0, totalSlots - bookedSlots);
            const utilization = totalSlots > 0 ? Math.round((bookedSlots / totalSlots) * 100) : 0;
            
            document.getElementById('availableSlots').textContent = availableSlots;
            document.getElementById('utilizationRate').textContent = utilization + '%';
        }

        function refreshSchedule() {
            loadScheduleForDate();
        }

        // Global mouse up handler to stop dragging
        document.addEventListener('mouseup', function() {
            if (isDragging) {
                isDragging = false;
                document.querySelectorAll('.time-slot').forEach(slot => {
                    slot.style.background = '';
                });
            }
        });
    </script>
</body>
</html>

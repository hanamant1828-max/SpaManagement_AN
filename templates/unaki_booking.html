<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Unaki Appointment Booking - Premium Timeline</title>

        <!-- External Resources -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
            rel="stylesheet"
        />

        <!-- Select2 CSS for searchable dropdowns -->
        <link
            href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
            rel="stylesheet"
        />

        <!-- Unaki Booking Styles -->
        <link rel="stylesheet" href="{{ url_for('static', filename='css/unaki_booking.css') }}" />

        <!-- jQuery MUST be loaded first -->
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <!-- Select2 JS -->
        <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
        <!-- Bootstrap -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Context Menu -->
        <script src="{{ url_for('static', filename='js/appointment_context_menu.js') }}"></script>
    </head>
    <body>
        <!-- Tooltip -->
        <div class="tooltip-custom" id="tooltip"></div>

        <div class="calendar-wrapper">
            <!-- Top Navigation -->
            <div class="calendar-top-nav">
                <div class="calendar-logo">
                    <i class="fas fa-calendar-check"></i>
                    <span>Unaki Booking</span>
                </div>

                <div class="calendar-date-nav">
                    <button
                        class="date-nav-btn"
                        onclick="navigateDate(-1)"
                        data-tooltip="Previous Day"
                    >
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button
                        class="date-today-btn"
                        onclick="navigateToToday()"
                        data-tooltip="Go to Today"
                    >
                        Today
                    </button>
                    <div class="current-date-display" id="currentDateDisplay">
                        {{ today_date }}
                    </div>
                    <button
                        class="date-nav-btn"
                        onclick="navigateDate(1)"
                        data-tooltip="Next Day"
                    >
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>

                <div style="display: flex; align-items: center; gap: 16px">
                    <!-- Stats -->
                    <div
                        style="
                            display: flex;
                            align-items: center;
                            gap: 8px;
                            padding: 8px 12px;
                            background: white;
                            border-radius: 10px;
                            border: 1px solid var(--border-color);
                        "
                    >
                        <i
                            class="fas fa-calendar-check"
                            style="color: var(--primary-color)"
                        ></i>
                        <div>
                            <div
                                style="
                                    font-size: 16px;
                                    font-weight: 700;
                                    color: #1f2937;
                                "
                                id="totalBookings"
                            >
                                0
                            </div>
                            <div style="font-size: 10px; color: #6b7280">
                                Total
                            </div>
                        </div>
                    </div>
                    <div
                        style="
                            display: flex;
                            align-items: center;
                            gap: 8px;
                            padding: 8px 12px;
                            background: white;
                            border-radius: 10px;
                            border: 1px solid var(--border-color);
                        "
                    >
                        <i
                            class="fas fa-check-circle"
                            style="color: var(--success-color)"
                        ></i>
                        <div>
                            <div
                                style="
                                    font-size: 16px;
                                    font-weight: 700;
                                    color: #1f2937;
                                "
                                id="completedBookings"
                            >
                                0
                            </div>
                            <div style="font-size: 10px; color: #6b7280">
                                Done
                            </div>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="calendar-actions">
                        <a
                            href="{{ url_for('multi_appointment_booking') }}"
                            class="action-btn action-btn-primary"
                            style="text-decoration: none;"
                        >
                            <i class="fas fa-plus-circle"></i>
                            New Appointment
                        </a>
                        <button
                            class="action-btn"
                            style="
                                background: var(--success-color);
                                color: white;
                                border: none;
                            "
                            data-bs-toggle="modal"
                            data-bs-target="#manualCheckinModal"
                        >
                            <i class="fas fa-user-check"></i>
                            Check-In Client
                        </button>
                        <a
                            href="{{ url_for('shift_scheduler.shift_scheduler') }}"
                            class="action-btn"
                            style="
                                background: var(--warning-color);
                                color: white;
                                text-decoration: none;
                            "
                        >
                            <i class="fas fa-calendar-check"></i>
                            Shift Scheduler
                        </a>
                        <button class="action-icon" onclick="refreshSchedule()">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                        <a
                            href="{{ url_for('dashboard') }}"
                            class="action-btn"
                            style="
                                background: var(--info-color);
                                color: white;
                                text-decoration: none;
                            "
                        >
                            <i class="fas fa-home"></i>
                            Dashboard
                        </a>
                    </div>
                </div>
            </div>

            <!-- Main Layout -->
            <div class="calendar-main-layout">
                <!-- Staff Sidebar -->
                <div class="staff-sidebar">
                    <div class="staff-sidebar-header">
                        <span>Staff Members</span>
                        <span class="staff-count"
                            >{{ staff_members|length if staff_members else 0
                            }}</span
                        >
                    </div>

                    <div class="staff-list">
                        {% if staff_members %} {% for staff in staff_members %}
                        <div
                            class="staff-row staff-row-{{ loop.index }}"
                            data-staff-id="{{ staff.id }}"
                        >
                            <div class="staff-avatar">
                                {{ (staff.first_name[:1] +
                                staff.last_name[:1]).upper() if staff.first_name
                                and staff.last_name else
                                staff.username[:2].upper() }}
                            </div>
                            <div class="staff-info">
                                <div class="staff-name">
                                    {{ staff.first_name }} {{ staff.last_name if
                                    staff.last_name else '' }}
                                </div>
                                <div class="staff-role">
                                    {{ staff.role or 'Therapist' }}
                                </div>
                                <div class="staff-status">
                                    <span class="status-dot"></span>
                                    Available
                                </div>
                            </div>
                        </div>
                        {% endfor %} {% endif %}
                    </div>
                </div>

                <!-- Timeline Panel -->
                <div class="timeline-panel">
                    <div class="timeline-header">
                        <div
                            class="timeline-header-inner"
                            id="timelineHeaderInner"
                        >
                            {% for hour in range(9, 22) %}
                            <div class="timeline-hour">
                                <span class="hour-label"
                                    >{{ '%d:00' % hour if hour < 12 else
                                    ('12:00' if hour == 12 else '%d:00' % (hour
                                    - 12)) }}</span
                                >
                                <span class="hour-period"
                                    >{{ 'AM' if hour < 12 else 'PM' }}</span
                                >
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="timeline-grid" id="timelineGrid">
                        {% if staff_members %} {% for staff in staff_members %}
                        <div
                            class="timeline-row"
                            data-staff-id="{{ staff.id }}"
                        >
                            {% for hour in range(9, 22) %}
                            <div
                                class="timeline-hour-slot"
                                data-hour="{{ hour }}"
                                data-staff-id="{{ staff.id }}"
                                onclick="handleSlotClick(event, {{ staff.id }}, {{ hour }}, 0)"
                            >
                                <div class="interval-marker interval-15"></div>
                                <div class="interval-marker interval-30"></div>
                                <div class="interval-marker interval-45"></div>
                            </div>
                            {% endfor %}
                        </div>
                        {% endfor %} {% endif %}

                        <div
                            class="current-time-line"
                            id="currentTimeLine"
                            style="display: none"
                        >
                            <div
                                class="current-time-label"
                                id="currentTimeLabel"
                            >
                                Now
                            </div>
                        </div>
                    </div>

                    <div class="loading-overlay" id="loadingOverlay">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Context Menu -->
        <div class="context-menu" id="contextMenu">
            <div class="context-menu-item" onclick="viewAppointmentDetails()">
                <i class="fas fa-eye"></i>View Details
            </div>
            <div class="context-menu-item" onclick="editAppointment()">
                <i class="fas fa-edit"></i>Edit Appointment
            </div>
            <div class="context-menu-divider"></div>
            <div class="context-menu-item" id="checkinMenuItem" onclick="checkinAppointment(selectedAppointmentId)" style="color: var(--success-color);">
                <i class="fas fa-user-check"></i>Check-In Client
            </div>
            <div class="context-menu-item" id="undoCheckinMenuItem" onclick="undoCheckin(selectedAppointmentId)" style="color: var(--warning-color); display: none;">
                <i class="fas fa-undo"></i>Undo Check-In
            </div>
            <div class="context-menu-divider"></div>
            <div class="context-menu-item danger" onclick="cancelAppointment()">
                <i class="fas fa-times-circle"></i>Cancel Appointment
            </div>
        </div>

        <script src="{{ url_for('static', filename='js/unaki_booking.js') }}"></script>
    </body>
</html>
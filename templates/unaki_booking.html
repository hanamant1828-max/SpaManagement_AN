<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unaki Appointment Booking - Professional Spa Management</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Appointment Context Menu -->
    <script src="{{ url_for('static', filename='js/appointment_context_menu.js') }}"></script>
    <!-- Custom Unaki Booking Styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/unaki_booking.css') }}">
</head>

<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content animate__animated animate__fadeIn">
            <div class="loading-spinner"></div>
            <h5 class="fw-bold text-primary mb-2">Loading Schedule</h5>
            <p class="text-muted mb-0">Preparing your appointment calendar...</p>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container animate__animated animate__fadeInUp">
        <!-- Header Section -->
        <div class="header-section">
            <div class="container-fluid">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <div class="d-flex align-items-center">
                            <div class="me-4">
                                <div style="width: 80px; height: 80px; background: rgba(255,255,255,0.2); border-radius: 20px; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-calendar-check" style="font-size: 2rem; color: white;"></i>
                                </div>
                            </div>
                            <div>
                                <h1 class="h2 mb-2 fw-bold">Unaki Appointment Booking</h1>
                                <p class="mb-0 opacity-75" style="font-size: 1.1rem;">
                                    <i class="fas fa-sparkles me-2"></i>
                                    Professional Spa Management System
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 text-end">
                        <div class="d-flex justify-content-end align-items-center gap-3">
                            <div class="text-end">
                                <div style="background: rgba(255,255,255,0.2); padding: 1rem; border-radius: 12px;">
                                    <div class="fw-bold" style="font-size: 1.25rem;" id="currentTime">--:--</div>
                                    <div class="opacity-75" style="font-size: 0.9rem;" id="currentDate">Loading...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Header Controls -->
        <div class="header-controls">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <div class="d-flex align-items-center">
                        <div class="me-4">
                            <label class="form-label mb-2 d-block fw-semibold">
                                <i class="fas fa-calendar-day me-2 text-primary"></i>Select Date:
                            </label>
                            <div class="position-relative">
                                <input type="date" id="scheduleDate" class="form-control ps-5" onchange="showLoadingAndLoad()" style="min-width: 200px;">
                                <i class="fas fa-calendar-alt position-absolute top-50 translate-middle-y ms-3 text-muted"></i>
                            </div>
                        </div>
                        <div class="d-flex gap-2">
                            <button class="btn btn-outline-secondary" onclick="navigateDate(-1)" title="Previous Day">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="btn btn-outline-secondary" onclick="navigateDate(1)" title="Next Day">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                            <button class="btn btn-outline-secondary" onclick="goToToday()" title="Today">
                                <i class="fas fa-home me-2"></i>Today
                            </button>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 text-end">
                    <div class="d-flex justify-content-end gap-3">
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#bookingModal" title="Book New Appointment">
                            <i class="fas fa-calendar-plus me-2"></i>
                            <span class="d-none d-sm-inline">Book Appointment</span>
                        </button>
                        <button class="btn btn-outline-secondary" onclick="showLoadingAndRefresh()" title="Refresh Schedule">
                            <i class="fas fa-sync-alt me-2"></i>
                            <span class="d-none d-md-inline">Refresh</span>
                        </button>
                        <div class="dropdown">
                            <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" title="Quick Actions">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <li><a class="dropdown-item" href="#" onclick="showLoadingAndLoadSample()">
                                    <i class="fas fa-database me-2"></i>Load Sample Data
                                </a></li>
                                <li><a class="dropdown-item" href="#" onclick="clearAllData()">
                                    <i class="fas fa-trash me-2"></i>Clear All Data
                                </a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" onclick="exportSchedule()">
                                    <i class="fas fa-download me-2"></i>Export Schedule
                                </a></li>
                                <li><a class="dropdown-item" href="#" onclick="printSchedule()">
                                    <i class="fas fa-print me-2"></i>Print Schedule
                                </a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Row -->
        <div class="stats-row">
            <div class="row g-4">
                <div class="col-6 col-lg-3">
                    <div class="stat-item fade-in">
                        <div class="stat-number" id="totalAppointments">0</div>
                        <div class="stat-label">
                            <i class="fas fa-calendar-check me-1"></i>Appointments
                        </div>
                    </div>
                </div>
                <div class="col-6 col-lg-3">
                    <div class="stat-item fade-in">
                        <div class="stat-number" id="totalStaff">0</div>
                        <div class="stat-label">
                            <i class="fas fa-users me-1"></i>Staff on Duty
                        </div>
                    </div>
                </div>
                <div class="col-6 col-lg-3">
                    <div class="stat-item fade-in">
                        <div class="stat-number" id="availableSlots">0</div>
                        <div class="stat-label">
                            <i class="fas fa-clock me-1"></i>Available Slots
                        </div>
                    </div>
                </div>
                <div class="col-6 col-lg-3">
                    <div class="stat-item fade-in">
                        <div class="stat-number" id="totalRevenue">$0</div>
                        <div class="stat-label">
                            <i class="fas fa-chart-line me-1"></i>Revenue
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Schedule Grid -->
        <div class="schedule-container">
            <div class="schedule-grid-container">
                <div id="scheduleGrid" class="schedule-grid" style="min-width: 6200px; position: relative;">
                    <!-- Grid content will be generated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Multi-Service Booking Modal -->
    <div class="modal fade" id="bookingModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold">
                        <i class="fas fa-calendar-plus me-2"></i>Create New Appointment
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <form id="bookingForm">
                        <!-- Client Information -->
                        <div class="row g-4 mb-4">
                            <div class="col-md-6">
                                <label class="form-label">
                                    <i class="fas fa-user me-2 text-primary"></i>Client *
                                </label>
                                <select id="clientSelect" class="form-select" required>
                                    <option value="">Select Client</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">
                                    <i class="fas fa-user-plus me-2 text-success"></i>New Client Name
                                </label>
                                <input type="text" id="clientName" class="form-control" placeholder="Enter new client name">
                            </div>
                        </div>

                        <div class="row g-4 mb-4">
                            <div class="col-md-6">
                                <label class="form-label">
                                    <i class="fas fa-phone me-2 text-info"></i>Phone
                                </label>
                                <input type="tel" id="clientPhone" class="form-control" placeholder="+1 (555) 123-4567">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">
                                    <i class="fas fa-envelope me-2 text-warning"></i>Email
                                </label>
                                <input type="email" id="clientEmail" class="form-control" placeholder="client@example.com">
                            </div>
                        </div>

                        <!-- Services Section -->
                        <div class="mb-4">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="mb-0">
                                    <i class="fas fa-spa me-2 text-primary"></i>Services *
                                </h6>
                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="addServiceRow()">
                                    <i class="fas fa-plus me-1"></i>Add Service
                                </button>
                            </div>

                            <div id="servicesContainer">
                                <!-- Services will be dynamically added here -->
                            </div>
                        </div>

                        <!-- Totals Section -->
                        <div class="row g-4 mb-4">
                            <div class="col-md-12">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <div class="row g-3">
                                            <div class="col-md-3">
                                                <label class="form-label">Total Duration</label>
                                                <input type="text" id="totalDuration" class="form-control" readonly>
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label">Subtotal</label>
                                                <input type="text" id="subtotalPrice" class="form-control" readonly>
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label">Discount ($)</label>
                                                <input type="number" id="discountAmount" class="form-control" value="0" min="0" step="0.01" onchange="calculateTotals()">
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label fw-bold">Grand Total</label>
                                                <input type="text" id="grandTotal" class="form-control fw-bold" readonly>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Notes Section -->
                        <div class="mb-3">
                            <label class="form-label">
                                <i class="fas fa-sticky-note me-2 text-info"></i>Notes
                            </label>
                            <textarea id="appointmentNotes" class="form-control" rows="3" placeholder="Any special requests or notes..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer bg-light">
                    <button type="button" class="btn btn-outline-info" onclick="checkAvailability()">
                        <i class="fas fa-search me-2"></i>Check Availability
                    </button>
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Cancel
                    </button>
                    <button type="button" class="btn btn-primary" onclick="bookMultiServiceAppointment()">
                        <i class="fas fa-check me-2"></i>Book Appointment
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom Unaki Booking JavaScript -->
    <script src="{{ url_for('static', filename='js/unaki_booking.js') }}"></script>
</body>
</html>
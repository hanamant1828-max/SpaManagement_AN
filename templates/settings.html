{% extends "base.html" %}

{% block title %}Settings - Spa & Salon Management Suite{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <h1 class="h3 mb-4">
                <i class="fas fa-cog me-2"></i>Settings & Configuration
            </h1>
        </div>
    </div>

    <!-- Settings Navigation -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <ul class="nav nav-pills" id="settingsTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="services-tab" data-bs-toggle="pill" data-bs-target="#services-settings" type="button" role="tab">
                                <i class="fas fa-spa me-1"></i>Services
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="packages-tab" data-bs-toggle="pill" data-bs-target="#packages-settings" type="button" role="tab">
                                <i class="fas fa-box me-1"></i>Packages
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="schedules-tab" data-bs-toggle="pill" data-bs-target="#schedules-settings" type="button" role="tab">
                                <i class="fas fa-calendar me-1"></i>Staff Schedules
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="system-tab" data-bs-toggle="pill" data-bs-target="#system-settings" type="button" role="tab">
                                <i class="fas fa-tools me-1"></i>System
                            </button>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Tab Content -->
    <div class="tab-content" id="settingsTabContent">
        <!-- Services Settings -->
        <div class="tab-pane fade show active" id="services-settings" role="tabpanel">
            <div class="row">
                <div class="col-lg-8">
                    <div class="card shadow">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">Services Management</h6>
                        </div>
                        <div class="card-body">
                            {% if services %}
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Service Name</th>
                                                <th>Category</th>
                                                <th>Duration</th>
                                                <th>Price</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for service in services %}
                                            <tr>
                                                <td>
                                                    <strong>{{ service.name }}</strong>
                                                    {% if service.description %}
                                                    <br><small class="text-muted">{{ utils.truncate_text(service.description, 50) }}</small>
                                                    {% endif %}
                                                </td>
                                                <td>
                                                    <span class="badge bg-secondary">{{ service.category.title() }}</span>
                                                </td>
                                                <td>{{ service.duration }} min</td>
                                                <td>{{ utils.format_currency(service.price) }}</td>
                                                <td>
                                                    <span class="badge bg-{{ 'success' if service.is_active else 'danger' }}">
                                                        {{ 'Active' if service.is_active else 'Inactive' }}
                                                    </span>
                                                </td>
                                                <td>
                                                    <div class="btn-group" role="group">
                                                        <button class="btn btn-sm btn-outline-secondary" 
                                                                onclick="editService({{ service.id }})">
                                                            <i class="fas fa-edit"></i>
                                                        </button>
                                                        <button class="btn btn-sm btn-outline-danger" 
                                                                onclick="toggleService({{ service.id }}, {{ service.is_active|lower }})">
                                                            <i class="fas fa-{{ 'eye-slash' if service.is_active else 'eye' }}"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            {% else %}
                                <div class="text-center py-4">
                                    <i class="fas fa-spa fa-3x text-muted mb-3"></i>
                                    <h5 class="text-muted">No services configured</h5>
                                    <p class="text-muted">Add your first service to get started.</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="col-lg-4">
                    <div class="card shadow">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">Add New Service</h6>
                        </div>
                        <div class="card-body">
                            <form method="POST" action="{{ url_for('add_service') }}">
                                {{ service_form.hidden_tag() }}
                                
                                <div class="mb-3">
                                    <label for="name" class="form-label">Service Name *</label>
                                    {{ service_form.name(class="form-control") }}
                                </div>
                                
                                <div class="mb-3">
                                    <label for="category" class="form-label">Category *</label>
                                    {{ service_form.category(class="form-select") }}
                                </div>
                                
                                <div class="row">
                                    <div class="col-6">
                                        <div class="mb-3">
                                            <label for="duration" class="form-label">Duration (min) *</label>
                                            {{ service_form.duration(class="form-control") }}
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="mb-3">
                                            <label for="price" class="form-label">Price *</label>
                                            {{ service_form.price(class="form-control", step="0.01") }}
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="description" class="form-label">Description</label>
                                    {{ service_form.description(class="form-control", rows="3") }}
                                </div>
                                
                                <div class="mb-3">
                                    <div class="form-check">
                                        {{ service_form.is_active(class="form-check-input", checked=True) }}
                                        <label class="form-check-label" for="is_active">
                                            Active
                                        </label>
                                    </div>
                                </div>
                                
                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="fas fa-plus me-2"></i>Add Service
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Packages Settings -->
        <div class="tab-pane fade" id="packages-settings" role="tabpanel">
            <div class="row">
                <div class="col-lg-8">
                    <div class="card shadow">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">Subscription Packages</h6>
                        </div>
                        <div class="card-body">
                            {% if packages %}
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Package Name</th>
                                                <th>Duration</th>
                                                <th>Price</th>
                                                <th>Discount</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for package in packages %}
                                            <tr>
                                                <td>
                                                    <strong>{{ package.name }}</strong>
                                                    {% if package.description %}
                                                    <br><small class="text-muted">{{ utils.truncate_text(package.description, 50) }}</small>
                                                    {% endif %}
                                                </td>
                                                <td>{{ package.duration_months }} months</td>
                                                <td>{{ utils.format_currency(package.total_price) }}</td>
                                                <td>{{ package.discount_percentage }}%</td>
                                                <td>
                                                    <span class="badge bg-{{ 'success' if package.is_active else 'danger' }}">
                                                        {{ 'Active' if package.is_active else 'Inactive' }}
                                                    </span>
                                                </td>
                                                <td>
                                                    <div class="btn-group" role="group">
                                                        <button class="btn btn-sm btn-outline-primary" 
                                                                onclick="viewPackage({{ package.id }})">
                                                            <i class="fas fa-eye"></i>
                                                        </button>
                                                        <button class="btn btn-sm btn-outline-secondary" 
                                                                onclick="editPackage({{ package.id }})">
                                                            <i class="fas fa-edit"></i>
                                                        </button>
                                                        <button class="btn btn-sm btn-outline-danger" 
                                                                onclick="togglePackage({{ package.id }}, {{ package.is_active|lower }})">
                                                            <i class="fas fa-{{ 'eye-slash' if package.is_active else 'eye' }}"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            {% else %}
                                <div class="text-center py-4">
                                    <i class="fas fa-box fa-3x text-muted mb-3"></i>
                                    <h5 class="text-muted">No packages configured</h5>
                                    <p class="text-muted">Create your first subscription package.</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="col-lg-4">
                    <div class="card shadow">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">Create Package</h6>
                        </div>
                        <div class="card-body">
                            <form method="POST" action="{{ url_for('add_package') }}">
                                {{ package_form.hidden_tag() }}
                                
                                <div class="mb-3">
                                    <label for="name" class="form-label">Package Name *</label>
                                    {{ package_form.name(class="form-control") }}
                                </div>
                                
                                <div class="mb-3">
                                    <label for="duration_months" class="form-label">Duration *</label>
                                    {{ package_form.duration_months(class="form-select") }}
                                </div>
                                
                                <div class="row">
                                    <div class="col-6">
                                        <div class="mb-3">
                                            <label for="total_price" class="form-label">Total Price *</label>
                                            {{ package_form.total_price(class="form-control", step="0.01") }}
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="mb-3">
                                            <label for="discount_percentage" class="form-label">Discount %</label>
                                            {{ package_form.discount_percentage(class="form-control", step="0.01") }}
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="description" class="form-label">Description</label>
                                    {{ package_form.description(class="form-control", rows="3") }}
                                </div>
                                
                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="fas fa-plus me-2"></i>Create Package
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Staff Schedules Settings -->
        <div class="tab-pane fade" id="schedules-settings" role="tabpanel">
            <div class="card shadow">
                <div class="card-header py-3 d-flex justify-content-between align-items-center">
                    <h6 class="m-0 font-weight-bold text-primary">Staff Working Schedules</h6>
                    <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addScheduleModal">
                        <i class="fas fa-plus me-1"></i>Add Schedule
                    </button>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-12">
                            <div class="alert alert-info" role="alert">
                                <i class="fas fa-info-circle me-2"></i>
                                Configure working hours for each staff member to optimize appointment scheduling.
                            </div>
                            
                            <div class="text-center py-5">
                                <i class="fas fa-calendar-week fa-3x text-muted mb-3"></i>
                                <h5 class="text-muted">Staff Schedule Management</h5>
                                <p class="text-muted">Schedule management interface would be implemented here with calendar views for each staff member.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Settings -->
        <div class="tab-pane fade" id="system-settings" role="tabpanel">
            <div class="row">
                <div class="col-lg-6">
                    <div class="card shadow">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">Business Information</h6>
                        </div>
                        <div class="card-body">
                            <form>
                                <div class="mb-3">
                                    <label class="form-label">Business Name</label>
                                    <input type="text" class="form-control" value="Spa & Salon Suite">
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Address</label>
                                    <textarea class="form-control" rows="3" placeholder="Enter business address"></textarea>
                                </div>
                                
                                <div class="row">
                                    <div class="col-6">
                                        <div class="mb-3">
                                            <label class="form-label">Phone</label>
                                            <input type="tel" class="form-control" placeholder="Business phone">
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="mb-3">
                                            <label class="form-label">Email</label>
                                            <input type="email" class="form-control" placeholder="Business email">
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Tax Rate (%)</label>
                                    <input type="number" class="form-control" step="0.01" value="0" placeholder="Default tax rate">
                                </div>
                                
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-2"></i>Save Business Info
                                </button>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="col-lg-6">
                    <div class="card shadow">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">Operational Settings</h6>
                        </div>
                        <div class="card-body">
                            <form>
                                <div class="mb-3">
                                    <label class="form-label">Business Hours</label>
                                    <div class="row">
                                        <div class="col-6">
                                            <input type="time" class="form-control" value="09:00">
                                            <small class="form-text text-muted">Opening time</small>
                                        </div>
                                        <div class="col-6">
                                            <input type="time" class="form-control" value="20:00">
                                            <small class="form-text text-muted">Closing time</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Appointment Buffer (minutes)</label>
                                    <input type="number" class="form-control" value="15" min="0" max="60">
                                    <small class="form-text text-muted">Time between appointments</small>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Booking Advance Limit (days)</label>
                                    <input type="number" class="form-control" value="30" min="1" max="365">
                                    <small class="form-text text-muted">Maximum days ahead for booking</small>
                                </div>
                                
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" checked>
                                        <label class="form-check-label">
                                            Enable SMS notifications
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" checked>
                                        <label class="form-check-label">
                                            Enable email reminders
                                        </label>
                                    </div>
                                </div>
                                
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-2"></i>Save Settings
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- System Status -->
                    <div class="card shadow mt-4">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">System Status</h6>
                        </div>
                        <div class="card-body">
                            <div class="list-group list-group-flush">
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    <span>Database Connection</span>
                                    <span class="badge bg-success">Connected</span>
                                </div>
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    <span>Backup Status</span>
                                    <span class="badge bg-warning">Pending</span>
                                </div>
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    <span>Storage Usage</span>
                                    <span class="badge bg-info">45%</span>
                                </div>
                            </div>
                            
                            <div class="mt-3 d-grid gap-2">
                                <button class="btn btn-outline-primary" onclick="backupData()">
                                    <i class="fas fa-download me-2"></i>Backup Data
                                </button>
                                <button class="btn btn-outline-warning" onclick="clearCache()">
                                    <i class="fas fa-broom me-2"></i>Clear Cache
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Schedule Modal -->
<div class="modal fade" id="addScheduleModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-calendar-plus me-2"></i>Add Staff Schedule
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="scheduleForm">
                    <div class="mb-3">
                        <label class="form-label">Staff Member</label>
                        <select class="form-select" required>
                            <option value="">Select staff member</option>
                            <!-- Staff options would be populated here -->
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Day of Week</label>
                        <select class="form-select" required>
                            <option value="0">Monday</option>
                            <option value="1">Tuesday</option>
                            <option value="2">Wednesday</option>
                            <option value="3">Thursday</option>
                            <option value="4">Friday</option>
                            <option value="5">Saturday</option>
                            <option value="6">Sunday</option>
                        </select>
                    </div>
                    
                    <div class="row">
                        <div class="col-6">
                            <div class="mb-3">
                                <label class="form-label">Start Time</label>
                                <input type="time" class="form-control" required>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="mb-3">
                                <label class="form-label">End Time</label>
                                <input type="time" class="form-control" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" checked>
                            <label class="form-check-label">
                                Available for appointments
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveSchedule()">
                    <i class="fas fa-save me-2"></i>Save Schedule
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
function editService(serviceId) {
    console.log('Edit service:', serviceId);
}

function toggleService(serviceId, isActive) {
    const action = isActive ? 'deactivate' : 'activate';
    if (confirm(`Are you sure you want to ${action} this service?`)) {
        // In a real implementation, this would make an AJAX call
        console.log(`Toggle service ${serviceId} to ${!isActive}`);
    }
}

function viewPackage(packageId) {
    console.log('View package:', packageId);
}

function editPackage(packageId) {
    console.log('Edit package:', packageId);
}

function togglePackage(packageId, isActive) {
    const action = isActive ? 'deactivate' : 'activate';
    if (confirm(`Are you sure you want to ${action} this package?`)) {
        console.log(`Toggle package ${packageId} to ${!isActive}`);
    }
}

function saveSchedule() {
    // In a real implementation, this would validate and save the schedule
    console.log('Save schedule');
    bootstrap.Modal.getInstance(document.getElementById('addScheduleModal')).hide();
}

function backupData() {
    if (confirm('This will create a backup of all your data. Continue?')) {
        // In a real implementation, this would trigger a backup process
        alert('Backup process initiated. You will be notified when complete.');
    }
}

function clearCache() {
    if (confirm('This will clear all cached data. Continue?')) {
        // In a real implementation, this would clear application cache
        alert('Cache cleared successfully.');
    }
}
</script>
{% endblock %}


{% extends "base.html" %}

{% block title %}Create Package - Simple{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h1 class="h3 mb-0">Create New Package</h1>
                    <p class="text-muted">Create packages with services and pricing - User Friendly Interface</p>
                </div>
                <a href="{{ url_for('packages') }}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Back to Packages
                </a>
            </div>

            <form method="POST" action="{{ url_for('simple_package_creation_submit') }}" id="packageForm">
                <div class="row">
                    <!-- Basic Package Info -->
                    <div class="col-lg-4">
                        <div class="card mb-4 shadow-sm">
                            <div class="card-header bg-primary text-white">
                                <h5 class="card-title mb-0"><i class="fas fa-info-circle"></i> 1. Package Details</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="name" class="form-label fw-bold">Package Name *</label>
                                    <input type="text" class="form-control form-control-lg" id="name" name="name" 
                                           placeholder="e.g., Premium Spa Package" required>
                                </div>

                                <div class="mb-3">
                                    <label for="package_type" class="form-label fw-bold">Package Type *</label>
                                    <select class="form-select form-select-lg" id="package_type" name="package_type" required>
                                        <option value="">Choose Package Type</option>
                                        <option value="regular">ðŸŽ¯ Regular Package</option>
                                        <option value="prepaid">ðŸ’³ Prepaid Package</option>
                                        <option value="service_package">ðŸŒŸ Service Package</option>
                                        <option value="membership">ðŸ‘‘ Membership</option>
                                        <option value="student_offer">ðŸŽ“ Student Offer</option>
                                        <option value="kitty_party">ðŸŽ‰ Kitty Party</option>
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label for="validity_days" class="form-label fw-bold">Validity (Days) *</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control form-control-lg" id="validity_days" name="validity_days" 
                                               value="90" min="1" max="730" required>
                                        <span class="input-group-text">days</span>
                                    </div>
                                    <div class="form-text text-success">Recommended: 90 days (3 months)</div>
                                </div>

                                <div class="mb-3">
                                    <label for="description" class="form-label fw-bold">Description</label>
                                    <textarea class="form-control" id="description" name="description" rows="3" 
                                              placeholder="Describe what's included in this package..."></textarea>
                                </div>

                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="is_active" name="is_active" checked>
                                    <label class="form-check-label fw-bold" for="is_active">
                                        <i class="fas fa-toggle-on text-success"></i> Make Package Active
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Service Selection -->
                    <div class="col-lg-5">
                        <div class="card mb-4 shadow-sm">
                            <div class="card-header bg-success text-white">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h5 class="card-title mb-0"><i class="fas fa-list-check"></i> 2. Select Services</h5>
                                    <div class="badge bg-light text-dark fs-6">
                                        Selected: <span id="selected-count">0</span>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body p-0">
                                <!-- Enhanced Search -->
                                <div class="p-3 bg-light">
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-search"></i></span>
                                        <input type="text" class="form-control" id="service-search" 
                                               placeholder="Search services by name...">
                                        <button class="btn btn-outline-secondary" type="button" onclick="clearSearch()">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- Enhanced Category Tabs -->
                                <div class="border-bottom">
                                    <nav class="nav nav-tabs nav-fill" id="service-tabs">
                                        <button class="nav-link active" type="button" onclick="filterServices('all')">
                                            <i class="fas fa-th-large"></i> All ({{ services|length }})
                                        </button>
                                        {% for category in categories %}
                                        <button class="nav-link" type="button" onclick="filterServices('{{ category.id }}')">
                                            <i class="{{ category.icon or 'fas fa-spa' }}"></i> {{ category.display_name }}
                                        </button>
                                        {% endfor %}
                                    </nav>
                                </div>

                                <!-- Enhanced Services List with Better Layout -->
                                <div id="services-container" style="max-height: 450px; overflow-y: auto;">
                                    {% for service in services %}
                                    <div class="service-card mb-3" data-category="{{ service.category_id or 'none' }}" 
                                         data-name="{{ service.name|lower }}" data-price="{{ service.price }}">
                                        <div class="card border-0 shadow-sm">
                                            <div class="service-item p-4 position-relative">
                                                <div class="row align-items-start">
                                                    <div class="col-1 text-center">
                                                        <div class="form-check">
                                                            <input class="form-check-input service-checkbox fs-5" type="checkbox" 
                                                                   name="selected_services" value="{{ service.id }}" 
                                                                   id="service_{{ service.id }}"
                                                                   data-price="{{ service.price }}" data-name="{{ service.name }}">
                                                        </div>
                                                    </div>
                                                    <div class="col-8">
                                                        <div class="service-details">
                                                            <h5 class="mb-2 fw-bold text-dark">{{ service.name }}</h5>
                                                            {% if service.description %}
                                                            <p class="text-muted mb-3 small">{{ service.description[:80] }}{% if service.description|length > 80 %}...{% endif %}</p>
                                                            {% endif %}
                                                            <div class="service-badges d-flex flex-wrap gap-2 mb-2">
                                                                <span class="badge bg-primary fs-6 px-3 py-2">
                                                                    <i class="fas fa-rupee-sign"></i> {{ service.price }}
                                                                </span>
                                                                {% if service.service_category %}
                                                                <span class="badge bg-secondary fs-6 px-3 py-2">
                                                                    <i class="fas fa-tags"></i> {{ service.service_category.display_name }}
                                                                </span>
                                                                {% endif %}
                                                                {% if service.duration %}
                                                                <span class="badge bg-info fs-6 px-3 py-2">
                                                                    <i class="fas fa-clock"></i> {{ service.duration }} min
                                                                </span>
                                                                {% endif %}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-3 text-end">
                                                        <button type="button" class="btn btn-outline-primary service-select-btn btn-lg" 
                                                                onclick="toggleService({{ service.id }})">
                                                            <i class="fas fa-plus me-2"></i>Add Service
                                                        </button>
                                                    </div>
                                                </div>

                                                <!-- Enhanced Sessions and Discount Controls -->
                                                <div class="service-controls mt-4 p-4 bg-light rounded-3 border" id="controls_{{ service.id }}" style="display: none;">
                                                    <div class="row g-4">
                                                        <div class="col-md-6">
                                                            <label class="form-label fw-bold text-dark mb-2">
                                                                <i class="fas fa-repeat me-2"></i>Number of Sessions
                                                            </label>
                                                            <div class="input-group input-group-lg">
                                                                <button type="button" class="btn btn-outline-secondary" onclick="adjustSessions({{ service.id }}, -1)">
                                                                    <i class="fas fa-minus"></i>
                                                                </button>
                                                                <input type="number" class="form-control text-center sessions-input fw-bold fs-5" 
                                                                       name="sessions_{{ service.id }}" value="1" min="1" max="20"
                                                                       onchange="updatePricing(); autoCalculatePackagePrice();">
                                                                <button type="button" class="btn btn-outline-secondary" onclick="adjustSessions({{ service.id }}, 1)">
                                                                    <i class="fas fa-plus"></i>
                                                                </button>
                                                            </div>
                                                            <small class="text-muted">How many times this service can be used</small>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <label class="form-label fw-bold text-dark mb-2">
                                                                <i class="fas fa-percent me-2"></i>Service Discount
                                                            </label>
                                                            <div class="input-group input-group-lg">
                                                                <input type="number" class="form-control discount-input text-center fw-bold fs-5" 
                                                                       name="service_discount_{{ service.id }}" value="0" min="0" max="100" step="5"
                                                                       onchange="updatePricing(); autoCalculatePackagePrice();">
                                                                <span class="input-group-text fw-bold">%</span>
                                                            </div>
                                                            <small class="text-muted">Discount for this specific service</small>
                                                        </div>
                                                    </div>
                                                    <div class="mt-3 text-center">
                                                        <div class="alert alert-success mb-0 py-2">
                                                            <h6 class="mb-0">
                                                                <i class="fas fa-calculator me-2"></i>Service Subtotal: 
                                                                <span class="fw-bold">â‚¹<span id="subtotal_{{ service.id }}">{{ service.price }}</span></span>
                                                            </h6>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>

                                <!-- No Services Found -->
                                <div id="no-services-found" class="text-center py-5" style="display: none;">
                                    <i class="fas fa-search fa-3x text-muted mb-3"></i>
                                    <h5 class="text-muted">No services found</h5>
                                    <p class="text-muted">Try a different search term or category</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Pricing -->
                    <div class="col-lg-3">
                        <div class="card mb-4 shadow-sm">
                            <div class="card-header bg-warning text-dark">
                                <h5 class="card-title mb-0"><i class="fas fa-calculator"></i> 3. Pricing Summary</h5>
                            </div>
                            <div class="card-body">
                                <!-- Live Pricing Summary -->
                                <div class="pricing-summary p-3 bg-light rounded mb-3">
                                    <div class="d-flex justify-content-between mb-2">
                                        <span><i class="fas fa-list"></i> Services Total:</span>
                                        <span class="fw-bold" id="services-total">â‚¹0.00</span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span><i class="fas fa-percent text-success"></i> Service Discounts:</span>
                                        <span class="text-success fw-bold" id="service-discounts">-â‚¹0.00</span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span><i class="fas fa-clock"></i> Total Sessions:</span>
                                        <span class="fw-bold" id="total-sessions">0</span>
                                    </div>
                                    <hr>
                                </div>

                                <!-- Package Price Input -->
                                <div class="mb-3">
                                    <label for="total_price" class="form-label fw-bold">Package Price *</label>
                                    <div class="input-group input-group-lg">
                                        <span class="input-group-text">â‚¹</span>
                                        <input type="number" class="form-control fw-bold" id="total_price" name="total_price" 
                                               min="0" step="0.01" required onchange="updatePricing()"
                                               placeholder="0.00">
                                    </div>
                                    <div class="mt-2">
                                        <button type="button" class="btn btn-outline-success btn-sm w-100" onclick="autoCalculatePrice()">
                                            <i class="fas fa-magic"></i> Auto-Calculate Price
                                        </button>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="discount_percentage" class="form-label fw-bold">Package Discount %</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="discount_percentage" name="discount_percentage" 
                                               value="0" min="0" max="100" step="0.1" onchange="updatePricing()">
                                        <span class="input-group-text">%</span>
                                    </div>
                                </div>

                                <!-- Final Summary -->
                                <div class="alert alert-info">
                                    <div class="text-center">
                                        <h5 class="mb-2">Final Price</h5>
                                        <h3 class="text-primary mb-2">â‚¹<span id="final-price">0.00</span></h3>
                                        <small class="text-success">You save: â‚¹<span id="total-savings">0.00</span></small>
                                    </div>
                                </div>

                                <!-- Selected Services Preview -->
                                <div id="selected-services-preview" class="mt-3" style="display: none;">
                                    <h6 class="fw-bold"><i class="fas fa-check-circle text-success"></i> Selected Services:</h6>
                                    <ul id="selected-services-list" class="list-unstyled small bg-light p-2 rounded"></ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Submit Section -->
                <div class="row">
                    <div class="col-12">
                        <div class="card border-success">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <a href="{{ url_for('packages') }}" class="btn btn-secondary btn-lg me-3">
                                            <i class="fas fa-times"></i> Cancel
                                        </a>
                                        <small class="text-muted">All changes will be lost</small>
                                    </div>
                                    <div>
                                        <button type="submit" class="btn btn-success btn-lg" id="submit-btn" disabled>
                                            <i class="fas fa-save"></i> Create Package
                                        </button>
                                        <div class="mt-1">
                                            <small class="text-muted" id="submit-status">Please select services and set price</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
.card {
    border: none;
    border-radius: 10px;
}

.shadow-sm {
    box-shadow: 0 .125rem .25rem rgba(0,0,0,.075)!important;
}

.service-card {
    transition: all 0.3s ease;
    margin-bottom: 1rem;
}

.service-card .card {
    border: 2px solid #e9ecef;
    border-radius: 12px;
    transition: all 0.3s ease;
}

.service-card .card:hover {
    border-color: #0d6efd;
    box-shadow: 0 4px 12px rgba(13, 110, 253, 0.15);
    transform: translateY(-2px);
}

.service-item {
    transition: all 0.3s ease;
    cursor: pointer;
    border-radius: 12px;
}

.service-item.selected {
    background: linear-gradient(135deg, #e7f3ff 0%, #f0f8ff 100%);
}

.service-card.selected .card {
    border-color: #0d6efd;
    background: linear-gradient(135deg, #e7f3ff 0%, #f0f8ff 100%);
    box-shadow: 0 4px 16px rgba(13, 110, 253, 0.25);
}

.service-details h5 {
    color: #2c3e50;
    font-size: 1.2rem;
}

.service-badges .badge {
    font-size: 0.85rem;
    font-weight: 500;
    border-radius: 8px;
}

.service-select-btn {
    font-weight: 600;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.service-select-btn:hover {
    transform: scale(1.05);
}

.form-check-input.fs-5 {
    width: 1.5rem;
    height: 1.5rem;
}

.service-controls {
    background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
    border: 1px solid #dee2e6;
}

.input-group-lg .form-control {
    font-size: 1.1rem;
    height: calc(3rem + 2px);
}

.alert-success {
    background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
    border-color: #b8dacc;
}

.service-controls {
    animation: slideDown 0.3s ease;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.pricing-summary {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border: 1px solid #dee2e6;
}

.nav-tabs .nav-link {
    border: none;
    border-radius: 0;
}

.nav-tabs .nav-link.active {
    background-color: #198754;
    color: white;
}

.badge {
    font-size: 0.75em;
}

.btn-lg {
    font-size: 1.1rem;
}

#services-container::-webkit-scrollbar {
    width: 6px;
}

#services-container::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
}

#services-container::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 10px;
}

#services-container::-webkit-scrollbar-thumb:hover {
    background: #555;
}
</style>

<script>
let selectedServices = new Set();

document.addEventListener('DOMContentLoaded', function() {
    // Initialize event listeners
    initializeServiceSelection();
    initializeSearch();
    
    // Form validation listeners
    document.getElementById('name').addEventListener('input', updateSubmitButton);
    document.getElementById('total_price').addEventListener('input', updateSubmitButton);
    
    // Auto-focus on name field
    document.getElementById('name').focus();
});

function initializeServiceSelection() {
    // Handle service selection
    document.querySelectorAll('.service-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const serviceId = this.value;
            toggleServiceSelection(serviceId, this.checked);
        });
    });
    
    // Make service items clickable
    document.querySelectorAll('.service-item').forEach(item => {
        item.addEventListener('click', function(e) {
            if (e.target.type !== 'checkbox' && e.target.tagName !== 'INPUT' && e.target.tagName !== 'BUTTON') {
                const checkbox = this.querySelector('.service-checkbox');
                checkbox.click();
            }
        });
    });
}

function initializeSearch() {
    const searchInput = document.getElementById('service-search');
    let searchTimeout;
    
    searchInput.addEventListener('input', function() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
            searchServices();
        }, 300);
    });
    
    searchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            searchServices();
        }
    });
}

function toggleService(serviceId) {
    const checkbox = document.getElementById(`service_${serviceId}`);
    checkbox.click();
}

function toggleServiceSelection(serviceId, isSelected) {
    const controlsDiv = document.getElementById(`controls_${serviceId}`);
    const serviceItem = document.querySelector(`#service_${serviceId}`).closest('.service-item');
    const serviceCard = document.querySelector(`#service_${serviceId}`).closest('.service-card');
    const selectBtn = serviceItem.querySelector('.service-select-btn');
    
    if (isSelected) {
        selectedServices.add(serviceId);
        controlsDiv.style.display = 'block';
        serviceItem.classList.add('selected');
        serviceCard.classList.add('selected');
        selectBtn.innerHTML = '<i class="fas fa-check me-2"></i>Added to Package';
        selectBtn.classList.remove('btn-outline-primary');
        selectBtn.classList.add('btn-success');
        
        // Smooth animation for controls
        controlsDiv.style.opacity = '0';
        controlsDiv.style.transform = 'translateY(-10px)';
        setTimeout(() => {
            controlsDiv.style.opacity = '1';
            controlsDiv.style.transform = 'translateY(0)';
        }, 100);
    } else {
        selectedServices.delete(serviceId);
        controlsDiv.style.display = 'none';
        serviceItem.classList.remove('selected');
        serviceCard.classList.remove('selected');
        selectBtn.innerHTML = '<i class="fas fa-plus me-2"></i>Add Service';
        selectBtn.classList.remove('btn-success');
        selectBtn.classList.add('btn-outline-primary');
    }
    
    updateSelectedCount();
    updatePricing();
    
    // Automatically calculate and set package price when services are selected/deselected
    if (selectedServices.size > 0) {
        autoCalculatePackagePrice();
    } else {
        document.getElementById('total_price').value = '';
    }
    
    updateSubmitButton();
}

function updateSelectedCount() {
    document.getElementById('selected-count').textContent = selectedServices.size;
}

function searchServices() {
    const searchTerm = document.getElementById('service-search').value.toLowerCase();
    const serviceCards = document.querySelectorAll('.service-card');
    let visibleCount = 0;
    
    serviceCards.forEach(card => {
        const serviceName = card.dataset.name;
        const isVisible = serviceName.includes(searchTerm);
        
        if (isVisible) {
            card.style.display = 'block';
            visibleCount++;
        } else {
            card.style.display = 'none';
        }
    });
    
    document.getElementById('no-services-found').style.display = visibleCount === 0 ? 'block' : 'none';
}

function clearSearch() {
    document.getElementById('service-search').value = '';
    searchServices();
    document.getElementById('service-search').focus();
}

function adjustSessions(serviceId, change) {
    const input = document.querySelector(`input[name="sessions_${serviceId}"]`);
    const currentValue = parseInt(input.value) || 1;
    const newValue = Math.max(1, Math.min(20, currentValue + change));
    input.value = newValue;
    updateServiceSubtotal(serviceId);
    updatePricing();
    
    // Auto-calculate package price when sessions change
    autoCalculatePackagePrice();
}

function updateServiceSubtotal(serviceId) {
    const checkbox = document.querySelector(`input[value="${serviceId}"]`);
    const sessionsInput = document.querySelector(`input[name="sessions_${serviceId}"]`);
    const discountInput = document.querySelector(`input[name="service_discount_${serviceId}"]`);
    const subtotalSpan = document.getElementById(`subtotal_${serviceId}`);
    
    if (checkbox && checkbox.checked) {
        const price = parseFloat(checkbox.dataset.price);
        const sessions = parseInt(sessionsInput.value) || 1;
        const discount = parseFloat(discountInput.value) || 0;
        
        const subtotal = price * sessions * (1 - discount / 100);
        subtotalSpan.textContent = subtotal.toFixed(2);
    }
}

function filterServices(categoryId) {
    const serviceCards = document.querySelectorAll('.service-card');
    const buttons = document.querySelectorAll('.nav-link');
    
    // Update active button
    buttons.forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    // Clear search
    document.getElementById('service-search').value = '';
    
    let visibleCount = 0;
    serviceCards.forEach(card => {
        if (categoryId === 'all' || card.dataset.category === categoryId) {
            card.style.display = 'block';
            visibleCount++;
        } else {
            card.style.display = 'none';
        }
    });
    
    document.getElementById('no-services-found').style.display = visibleCount === 0 ? 'block' : 'none';
}

function updatePricing() {
    let servicesTotal = 0;
    let serviceDiscounts = 0;
    let totalSessions = 0;
    const selectedServicesList = [];
    
    document.querySelectorAll('.service-checkbox:checked').forEach(checkbox => {
        const serviceId = checkbox.value;
        const serviceName = checkbox.dataset.name;
        const servicePrice = parseFloat(checkbox.dataset.price);
        const sessionsInput = document.querySelector(`input[name="sessions_${serviceId}"]`);
        const discountInput = document.querySelector(`input[name="service_discount_${serviceId}"]`);
        
        const sessions = parseInt(sessionsInput.value) || 1;
        const discount = parseFloat(discountInput.value) || 0;
        
        const originalAmount = servicePrice * sessions;
        const discountAmount = originalAmount * (discount / 100);
        
        servicesTotal += originalAmount;
        serviceDiscounts += discountAmount;
        totalSessions += sessions;
        
        updateServiceSubtotal(serviceId);
        selectedServicesList.push(`${serviceName} (${sessions}x)`);
    });
    
    // Update display
    document.getElementById('services-total').textContent = `â‚¹${servicesTotal.toFixed(2)}`;
    document.getElementById('service-discounts').textContent = `-â‚¹${serviceDiscounts.toFixed(2)}`;
    document.getElementById('total-sessions').textContent = totalSessions;
    
    // Calculate final price
    const packagePrice = parseFloat(document.getElementById('total_price').value) || 0;
    const packageDiscount = parseFloat(document.getElementById('discount_percentage').value) || 0;
    const packageDiscountAmount = packagePrice * (packageDiscount / 100);
    const finalPrice = packagePrice - packageDiscountAmount;
    const totalSavings = servicesTotal - finalPrice;
    
    document.getElementById('final-price').textContent = finalPrice.toFixed(2);
    document.getElementById('total-savings').textContent = Math.max(0, totalSavings).toFixed(2);
    
    // Update selected services preview
    const preview = document.getElementById('selected-services-preview');
    const list = document.getElementById('selected-services-list');
    
    if (selectedServicesList.length > 0) {
        list.innerHTML = selectedServicesList.map(service => 
            `<li class="mb-1"><i class="fas fa-check-circle text-success"></i> ${service}</li>`
        ).join('');
        preview.style.display = 'block';
    } else {
        preview.style.display = 'none';
    }
}

function autoCalculatePrice() {
    autoCalculatePackagePrice();
    
    // Show success message if triggered by button click
    if (event && event.target) {
        const btn = event.target;
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-check"></i> Price Calculated!';
        btn.classList.add('btn-success');
        btn.classList.remove('btn-outline-success');
        
        setTimeout(() => {
            btn.innerHTML = originalText;
            btn.classList.remove('btn-success');
            btn.classList.add('btn-outline-success');
        }, 2000);
    }
}

function autoCalculatePackagePrice() {
    let total = 0;
    
    document.querySelectorAll('.service-checkbox:checked').forEach(checkbox => {
        const serviceId = checkbox.value;
        const servicePrice = parseFloat(checkbox.dataset.price);
        const sessionsInput = document.querySelector(`input[name="sessions_${serviceId}"]`);
        const discountInput = document.querySelector(`input[name="service_discount_${serviceId}"]`);
        
        const sessions = parseInt(sessionsInput?.value) || 1;
        const discount = parseFloat(discountInput?.value) || 0;
        
        const amount = servicePrice * sessions * (1 - discount / 100);
        total += amount;
    });
    
    // Set the calculated price
    const priceInput = document.getElementById('total_price');
    if (priceInput) {
        priceInput.value = total.toFixed(2);
        updatePricing();
    }
}

function updateSubmitButton() {
    const submitBtn = document.getElementById('submit-btn');
    const submitStatus = document.getElementById('submit-status');
    const hasServices = selectedServices.size > 0;
    const hasName = document.getElementById('name').value.trim().length > 0;
    const hasPrice = parseFloat(document.getElementById('total_price').value) > 0;
    
    if (!hasName) {
        submitStatus.textContent = 'Please enter package name';
        submitBtn.disabled = true;
    } else if (!hasServices) {
        submitStatus.textContent = 'Please select at least one service';
        submitBtn.disabled = true;
    } else if (!hasPrice) {
        submitStatus.textContent = 'Please set package price';
        submitBtn.disabled = true;
    } else {
        submitStatus.textContent = 'Ready to create package!';
        submitStatus.className = 'text-success';
        submitBtn.disabled = false;
    }
}
</script>
{% endblock %}

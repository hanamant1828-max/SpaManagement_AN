<div>
    <!-- Status Overview Header -->
    <div class="row mb-4">
        <div class="col-12">
            <h4 class="mb-3">
                <i class="fas fa-chart-line me-2"></i>
                Inventory Status Overview
            </h4>
            <p class="text-muted">Comprehensive view of current inventory status and alerts</p>
        </div>
    </div>

    <!-- Overview Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4 class="card-title" id="totalProducts">-</h4>
                            <p class="card-text">Total Products</p>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-boxes fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-info text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4 class="card-title" id="totalBatches">-</h4>
                            <p class="card-text">Active Batches</p>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-layer-group fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4 class="card-title" id="totalValue">$0</h4>
                            <p class="card-text">Total Value</p>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-dollar-sign fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-secondary text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4 class="card-title" id="inStockCount">-</h4>
                            <p class="card-text">Items in Stock</p>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-check-circle fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Alerts Row -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-exclamation-triangle me-2"></i>Inventory Alerts</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <span class="badge bg-danger me-2" id="outOfStockCount">0</span>
                            <span>Out of Stock</span>
                        </div>
                        <div class="col-md-3">
                            <span class="badge bg-warning me-2" id="lowStockCount">0</span>
                            <span>Low Stock</span>
                        </div>
                        <div class="col-md-3">
                            <span class="badge bg-dark me-2" id="expiredCount">0</span>
                            <span>Expired</span>
                        </div>
                        <div class="col-md-3">
                            <span class="badge bg-warning me-2" id="expiringSoonCount">0</span>
                            <span>Expiring Soon</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Two Column Layout -->
    <div class="row mb-4">
        <!-- Left Column - Categories -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-tags me-2"></i>Products by Category</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Category</th>
                                    <th class="text-end">Products</th>
                                </tr>
                            </thead>
                            <tbody id="categoryBreakdown">
                                <tr>
                                    <td colspan="2" class="text-center text-muted">Loading...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column - Recent Activity -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-clock me-2"></i>Recent Activity (7 Days)</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-6">
                            <div class="text-center">
                                <h4 class="text-primary" id="recentConsumption">-</h4>
                                <small class="text-muted">Consumption Records</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="text-center">
                                <h4 class="text-warning" id="recentAdjustments">-</h4>
                                <small class="text-muted">Stock Adjustments</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Items Requiring Attention -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-exclamation-circle me-2"></i>Items Requiring Attention</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Product Name</th>
                                    <th>SKU</th>
                                    <th class="text-end">Current Stock</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="lowStockItems">
                                <tr>
                                    <td colspan="4" class="text-center text-muted">Loading...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Expired/Expiring Items -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-calendar-times me-2"></i>Expired Batches</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Batch</th>
                                    <th>Product</th>
                                    <th>Expired Date</th>
                                    <th class="text-end">Qty</th>
                                </tr>
                            </thead>
                            <tbody id="expiredBatches">
                                <tr>
                                    <td colspan="4" class="text-center text-muted">Loading...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-calendar-exclamation me-2"></i>Expiring Soon</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Batch</th>
                                    <th>Product</th>
                                    <th>Expiry Date</th>
                                    <th class="text-end">Days Left</th>
                                </tr>
                            </thead>
                            <tbody id="expiringSoonBatches">
                                <tr>
                                    <td colspan="4" class="text-center text-muted">Loading...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Detailed Tables Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-list-alt me-2"></i>Product-wise Quantity Summary</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Product Name</th>
                                    <th>SKU</th>
                                    <th>Category</th>
                                    <th class="text-end">Total Quantity</th>
                                    <th class="text-end">Batches</th>
                                    <th class="text-end">Total Value</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="productWiseTable">
                                <tr>
                                    <td colspan="7" class="text-center text-muted">Loading...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-boxes me-2"></i>Batch-wise Quantity Details</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Batch Name</th>
                                    <th>Product</th>
                                    <th>Location</th>
                                    <th class="text-end">Available Qty</th>
                                    <th class="text-end">Unit Cost</th>
                                    <th class="text-end">Total Value</th>
                                    <th>Mfg Date</th>
                                    <th>Expiry Date</th>
                                </tr>
                            </thead>
                            <tbody id="batchWiseTable">
                                <tr>
                                    <td colspan="8" class="text-center text-muted">Loading...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Refresh Button -->
    <div class="row">
        <div class="col-12 text-end">
            <button class="btn btn-primary" onclick="loadInventoryStatus()">
                <i class="fas fa-sync-alt me-2"></i>
                Refresh Status
            </button>
        </div>
    </div>
</div>

<script>
    // Load inventory status data
    function loadInventoryStatus() {
        console.log('Loading inventory status...');
        
        fetch('/api/inventory/status')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    populateOverview(data.overview);
                    populateAlerts(data.alerts);
                    populateCategoryBreakdown(data.category_breakdown);
                    populateRecentActivity(data.recent_activity);
                    populateLowStockItems(data.low_stock_items);
                    populateExpiredBatches(data.expired_batches);
                    populateExpiringSoon(data.expiring_soon);
                    populateProductWiseTable(data.product_wise_data);
                    populateBatchWiseTable(data.batch_wise_data);
                    console.log('Inventory status loaded successfully');
                } else {
                    console.error('Error loading inventory status:', data.error);
                    alert('Error loading inventory status: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while loading inventory status.');
            });
    }

    function populateOverview(overview) {
        document.getElementById('totalProducts').textContent = overview.total_products || 0;
        document.getElementById('totalBatches').textContent = overview.total_batches || 0;
        document.getElementById('totalValue').textContent = '$' + (overview.total_inventory_value || 0).toLocaleString();
        document.getElementById('inStockCount').textContent = overview.stock_summary.in_stock || 0;
    }

    function populateAlerts(alerts) {
        document.getElementById('outOfStockCount').textContent = alerts.out_of_stock_count || 0;
        document.getElementById('lowStockCount').textContent = alerts.low_stock_count || 0;
        document.getElementById('expiredCount').textContent = alerts.expired_batches_count || 0;
        document.getElementById('expiringSoonCount').textContent = alerts.expiring_soon_count || 0;
    }

    function populateCategoryBreakdown(categories) {
        const tbody = document.getElementById('categoryBreakdown');
        
        if (!categories || categories.length === 0) {
            tbody.innerHTML = '<tr><td colspan="2" class="text-center text-muted">No categories found</td></tr>';
            return;
        }
        
        tbody.innerHTML = categories.map(cat => `
            <tr>
                <td>${cat.category}</td>
                <td class="text-end"><span class="badge bg-primary">${cat.product_count}</span></td>
            </tr>
        `).join('');
    }

    function populateRecentActivity(activity) {
        document.getElementById('recentConsumption').textContent = activity.consumption_records || 0;
        document.getElementById('recentAdjustments').textContent = activity.adjustments || 0;
    }

    function populateLowStockItems(items) {
        const tbody = document.getElementById('lowStockItems');
        
        if (!items || items.length === 0) {
            tbody.innerHTML = '<tr><td colspan="4" class="text-center text-muted">No low stock items</td></tr>';
            return;
        }
        
        tbody.innerHTML = items.map(item => `
            <tr>
                <td>${item.name}</td>
                <td><code>${item.sku}</code></td>
                <td class="text-end">${item.current_stock}</td>
                <td>
                    <span class="badge ${getStatusBadgeClass(item.status)}">
                        ${item.status.replace('_', ' ').toUpperCase()}
                    </span>
                </td>
            </tr>
        `).join('');
    }

    function populateExpiredBatches(batches) {
        const tbody = document.getElementById('expiredBatches');
        
        if (!batches || batches.length === 0) {
            tbody.innerHTML = '<tr><td colspan="4" class="text-center text-muted">No expired batches</td></tr>';
            return;
        }
        
        tbody.innerHTML = batches.map(batch => `
            <tr>
                <td><code>${batch.batch_name}</code></td>
                <td>${batch.product_name}</td>
                <td>${new Date(batch.expiry_date).toLocaleDateString()}</td>
                <td class="text-end">${batch.qty_available}</td>
            </tr>
        `).join('');
    }

    function populateExpiringSoon(batches) {
        const tbody = document.getElementById('expiringSoonBatches');
        
        if (!batches || batches.length === 0) {
            tbody.innerHTML = '<tr><td colspan="4" class="text-center text-muted">No batches expiring soon</td></tr>';
            return;
        }
        
        tbody.innerHTML = batches.map(batch => `
            <tr>
                <td><code>${batch.batch_name}</code></td>
                <td>${batch.product_name}</td>
                <td>${new Date(batch.expiry_date).toLocaleDateString()}</td>
                <td class="text-end">
                    <span class="badge bg-warning">${batch.days_until_expiry} days</span>
                </td>
            </tr>
        `).join('');
    }

    function populateProductWiseTable(products) {
        const tbody = document.getElementById('productWiseTable');
        
        if (!products || products.length === 0) {
            tbody.innerHTML = '<tr><td colspan="7" class="text-center text-muted">No products found</td></tr>';
            return;
        }
        
        tbody.innerHTML = products.map(product => `
            <tr>
                <td>${product.name}</td>
                <td><code>${product.sku}</code></td>
                <td><span class="badge bg-secondary">${product.category}</span></td>
                <td class="text-end">${product.total_quantity} <small class="text-muted">${product.unit_of_measure}</small></td>
                <td class="text-end"><span class="badge bg-info">${product.batch_count}</span></td>
                <td class="text-end">$${product.total_value.toLocaleString()}</td>
                <td>
                    <span class="badge ${getStatusBadgeClass(product.status)}">
                        ${product.status.replace('_', ' ').toUpperCase()}
                    </span>
                </td>
            </tr>
        `).join('');
    }

    function populateBatchWiseTable(batches) {
        const tbody = document.getElementById('batchWiseTable');
        
        if (!batches || batches.length === 0) {
            tbody.innerHTML = '<tr><td colspan="8" class="text-center text-muted">No batches found</td></tr>';
            return;
        }
        
        tbody.innerHTML = batches.map(batch => `
            <tr>
                <td><code>${batch.batch_name}</code></td>
                <td>${batch.product_name}</td>
                <td><span class="badge bg-secondary">${batch.location_name}</span></td>
                <td class="text-end">${batch.qty_available} <small class="text-muted">${batch.unit_of_measure}</small></td>
                <td class="text-end">$${batch.unit_cost.toFixed(2)}</td>
                <td class="text-end">$${batch.total_value.toFixed(2)}</td>
                <td>${batch.mfg_date ? new Date(batch.mfg_date).toLocaleDateString() : '-'}</td>
                <td>${batch.expiry_date ? new Date(batch.expiry_date).toLocaleDateString() : 'No expiry'}</td>
            </tr>
        `).join('');
    }

    function getStatusBadgeClass(status) {
        switch(status) {
            case 'out_of_stock': return 'bg-danger';
            case 'low_stock': return 'bg-warning';
            case 'in_stock': return 'bg-success';
            default: return 'bg-secondary';
        }
    }

    // Load data when this content is shown
    document.addEventListener('DOMContentLoaded', function() {
        // Small delay to ensure DOM is ready
        setTimeout(loadInventoryStatus, 500);
    });

    // Also trigger when this tab becomes visible (for dynamic loading)
    if (typeof window.loadInventoryStatus === 'undefined') {
        window.loadInventoryStatus = loadInventoryStatus;
    }
</script>
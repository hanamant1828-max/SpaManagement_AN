function checkPackageBenefit(serviceId, servicePrice, quantity) {
    debugger; // ðŸ”´ BREAKPOINT 1: Entry point - check if function is called
    console.log('ðŸ” checkPackageBenefit called:', { serviceId, servicePrice, quantity });
    
    if (!BillingState.customerPackages || !BillingState.customerPackages.packages) {
        debugger; // ðŸ”´ BREAKPOINT 2: No packages state - check why packages are missing
        console.log('â„¹ï¸ No customer packages available');
        console.log('BillingState.customerPackages:', BillingState.customerPackages);
        return 0;
    }

    let totalBenefit = 0;
    let benefitApplied = false;

    debugger; // ðŸ”´ BREAKPOINT 3: Before package loop - inspect packages array
    console.log('ðŸ“¦ Total packages to check:', BillingState.customerPackages.packages.length);
    console.log('ðŸ“¦ Packages array:', BillingState.customerPackages.packages);

    BillingState.customerPackages.packages.forEach(pkg => {
        debugger; // ðŸ”´ BREAKPOINT 4: Inside package loop - check each package
        console.log('ðŸ“¦ Checking package:', {
            id: pkg.assignment_id || pkg.id,
            type: pkg.package_type,
            name: pkg.package_name || pkg.name,
            serviceId: pkg.service_id,
            serviceName: pkg.service_name,
            remainingSessions: pkg.remaining_sessions || pkg.sessions?.remaining,
            remainingCredit: pkg.remaining_credit || pkg.credit?.remaining,
            selectedServiceId: serviceId
        });

        if (pkg.package_type === 'service_package') {
            debugger; // ðŸ”´ BREAKPOINT 5: Service package found - check matching logic
            const remainingSessions = pkg.remaining_sessions || pkg.sessions?.remaining || 0;
            
            // Get the correct service_id from package - could be in different places
            const packageServiceId = pkg.service_id || (pkg.services && pkg.services.length > 0 ? pkg.services[0].service_id : null);
            
            console.log('ðŸ” Service package match check:', {
                packageId: pkg.id || pkg.assignment_id,
                packageServiceId: packageServiceId,
                selectedServiceId: serviceId,
                matches: packageServiceId == serviceId,  // Use == for type coercion
                remainingSessions: remainingSessions,
                fullPackageObject: pkg
            });
            
            if (packageServiceId == serviceId && remainingSessions > 0) {
                debugger; // ðŸ”´ BREAKPOINT 6: Match found! - check benefit calculation
                const sessionsToCover = Math.min(quantity, remainingSessions);
                const pricePerSession = servicePrice / quantity;
                const benefitAmount = sessionsToCover * pricePerSession;
                
                totalBenefit += benefitAmount;
                benefitApplied = true;
                
                console.log('âœ… Service package benefit applied:', {
                    serviceId,
                    packageName: pkg.package_name || pkg.name,
                    sessionsCovered: sessionsToCover,
                    benefitAmount: benefitAmount.toFixed(2),
                    remainingSessions: remainingSessions,
                    remainingAfter: remainingSessions - sessionsToCover
                });
            } else {
                debugger; // ðŸ”´ BREAKPOINT 7: No match - why?
                console.log('âŒ Service package NOT applied - reason:', {
                    serviceIdMatch: pkg.service_id === serviceId,
                    packageServiceId: pkg.service_id,
                    selectedServiceId: serviceId,
                    hasRemainingSessions: remainingSessions > 0,
                    remainingSessions: remainingSessions
                });
            }
        } else if (pkg.package_type === 'membership') {
            const coveredServices = pkg.services || [];
            const isCovered = coveredServices.some(s => s.service_id === serviceId);

            if (isCovered) {
                const discountRate = pkg.discount_percentage ? (pkg.discount_percentage / 100) : 0.2;
                const benefitAmount = servicePrice * discountRate;
                
                totalBenefit += benefitAmount;
                benefitApplied = true;
                
                console.log('âœ… Membership discount applied:', {
                    serviceId,
                    packageName: pkg.package_name,
                    discountRate: (discountRate * 100).toFixed(0) + '%',
                    originalPrice: servicePrice.toFixed(2),
                    benefitAmount: benefitAmount.toFixed(2),
                    finalPrice: (servicePrice - benefitAmount).toFixed(2)
                });
            }
        } else if (pkg.package_type === 'prepaid') {
            const remainingCredit = pkg.remaining_credit || 0;
            
            if (remainingCredit > 0) {
                const benefitAmount = Math.min(servicePrice, remainingCredit);
                
                totalBenefit += benefitAmount;
                benefitApplied = true;
                
                console.log('âœ… Prepaid credit applied:', {
                    serviceId,
                    packageName: pkg.package_name,
                    creditUsed: benefitAmount.toFixed(2),
                    remainingCredit: remainingCredit.toFixed(2)
                });
            }
        }
    });

    if (!benefitApplied) {
        debugger; // ðŸ”´ BREAKPOINT 8: No benefit applied - inspect why
        console.log('â„¹ï¸ No package benefit applied for serviceId:', serviceId);
        console.log('ðŸ“‹ All packages checked:', BillingState.customerPackages.packages.map(p => ({
            type: p.package_type,
            service_id: p.service_id,
            service_name: p.service_name,
            remaining: p.remaining_sessions || p.sessions?.remaining
        })));
    } else {
        debugger; // ðŸ”´ BREAKPOINT 9: Benefit applied successfully
        console.log('âœ… Benefit successfully applied:', totalBenefit.toFixed(2));
    }

    console.log('ðŸ’° Total benefit calculated:', totalBenefit.toFixed(2));
    return totalBenefit;
}
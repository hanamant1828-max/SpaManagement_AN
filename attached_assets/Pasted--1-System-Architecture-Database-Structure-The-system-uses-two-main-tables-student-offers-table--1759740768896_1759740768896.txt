
1. System Architecture
Database Structure

The system uses two main tables:

student_offers table:

    id - Primary key
    name - Offer name (e.g., "Student Discount 12%")
    price - Base package price
    discount_percentage - Discount percentage (1-100%)
    valid_from - Start date
    valid_to - End date
    valid_days - Days when offer is valid (e.g., "Mon-Fri")
    conditions - Terms & conditions text
    is_active - Active/inactive status
    created_at - Creation timestamp

student_offer_services table (junction table):

    Links student offers to multiple services
    offer_id - Foreign key to student_offers
    service_id - Foreign key to services
    Enables many-to-many relationship

2. User Interface Components
A. Main Package Management Page (
)

Location: /packages#assign-student tab

Features:

    Table displaying all student offers with columns:
        Offer Name
        Services (comma-separated list)
        Discount %
        Validity Date
        Actions (Edit, Delete, Assign)
    "Add New Student Offer" button
    Real-time count of total offers

B. Add Student Offer Page (
)

Route: /student-offers/add

Form Sections:

    Service Selection
        Checkbox list of all available services
        Scrollable container (max-height: 300px)
        Multi-select capability
        Validation: At least 1 service required

    Offer Details
        Optional offer name field
        Auto-generates name if empty (e.g., "Student Discount 25%")

    Discount Configuration
        Package Price input (₹)
        Discount Percentage (1-100%)
        Valid Days dropdown:
            Mon-Fri
            Mon-Sat
            All Days
            Weekends Only
            Custom (shows text field)

    Validity Period
        Valid From date picker
        Valid Until date picker
        Default: Today to +6 months
        Validation: End date must be after start date

    Terms & Conditions
        Textarea for conditions
        Default text: "Valid with Student ID only. Cannot be combined with other offers."
        Max 500 characters

Real-time Features:

    Live preview panel showing:
        Offer name
        Package price
        Discount percentage
        Final calculated price
        Selected services (first 3 + count)
        Valid days
        Period
    Form validation with error messages
    Save button enabled only when all validations pass

C. Edit Student Offer Page (
)

Route: /student-offers/edit?id=<offer_id>

Same form structure as Add page, but:

    Pre-populated with existing data
    Loading overlay while fetching data
    Update button instead of Save
    Redirects back to packages page after update

3. JavaScript Functionality
Main Script (
)

Key Functions:

    loadStudentOffersTable()
        Fetches all offers from /packages/api/student-offers
        Populates table with data
        Adds action buttons (Edit, Delete, Assign)
        Updates offer count

    validateStudentOfferForm() / validateEditStudentOfferForm()
        Real-time validation:
            Services: At least 1 selected
            Discount: Between 1-100%
            Dates: Valid from < Valid to
            All required fields filled
        Shows/hides error messages
        Enables/disables save button

    updateStudentOfferPreview()
        Calculates final price after discount
        Shows selected services summary
        Updates preview panel in real-time

    handleFormSubmit() / handleEditFormSubmit()
        Collects form data
        Handles custom valid days
        Converts to JSON
        POSTs to API endpoint
        Shows success/error messages
        Redirects on success

    editStudentOffer(offerId)
        Redirects to edit page with offer ID

    deleteStudentOffer(offerId)
        Confirms deletion
        DELETEs via API
        Reloads table

    assignStudentOffer(offerId)
        Opens assignment modal
        Sets offer type and ID
        Loads customer list

4. Backend API Endpoints
GET /packages/api/student-offers

Purpose: Fetch all student offers with related services

Response:

[
  {
    "id": 1,
    "name": "Student Discount 20%",
    "price": 500.0,
    "discount_percentage": 20.0,
    "valid_from": "2025-10-06",
    "valid_to": "2026-04-06",
    "valid_days": "Mon-Fri",
    "conditions": "Valid with Student ID only",
    "is_active": true,
    "services": [
      {"id": 1, "name": "Classic Facial", "price": 65.0},
      {"id": 2, "name": "Deep Hair Treatment", "price": 40.0}
    ],
    "created_at": "2025-10-06T08:30:00"
  }
]

POST /packages/api/student-offers

Purpose: Create new student offer

Request Body:

{
  "service_ids": [1, 2, 3],
  "name": "Weekend Student Special",
  "price": 500.0,
  "discount_percentage": 25,
  "valid_from": "2025-10-06",
  "valid_to": "2026-04-06",
  "valid_days": "Mon-Fri",
  "conditions": "Valid with Student ID",
  "is_active": true
}

Response:

{
  "success": true,
  "offer_id": 5,
  "message": "Student offer created successfully"
}

GET /api/student-offers/<offer_id>

Purpose: Get single offer details for editing

Response:

{
  "success": true,
  "offer": {
    "id": 5,
    "name": "Weekend Student Special",
    "price": 500.0,
    "discount_percentage": 25,
    "valid_from": "2025-10-06",
    "valid_to": "2026-04-06",
    "valid_days": "Mon-Fri",
    "conditions": "Valid with Student ID",
    "services": [
      {"id": 1, "name": "Classic Facial"},
      {"id": 2, "name": "Massage"}
    ]
  }
}

PUT /api/student-offers/<offer_id>

Purpose: Update existing offer

Request Body: Same as POST

Response:

{
  "success": true,
  "message": "Student offer updated successfully"
}

DELETE /packages/api/student-offers/<offer_id>

Purpose: Delete student offer

Response:

{
  "success": true,
  "message": "Student offer deleted successfully"
}

5. Assignment Flow

When a student offer is assigned to a customer:

    Click "Assign" button → Opens assignment modal
    Select customer from dropdown
    Click "Assign Package"
    POST to /packages/api/assign with:

    {
      "customer_id": 40,
      "package_id": 5,
      "package_type": "student_offer",
      "price_paid": 0.0,
      "notes": "Student offer assignment"
    }

    Creates record in service_package_assignments table
    Offer appears in customer's package list in billing

6. Billing Integration

When billing a customer with assigned student offer:

    System checks for active student offers
    Validates:
        Offer not expired (valid_to >= today)
        Current day matches valid_days
        Service is in offer's service list
    If valid, applies discount percentage to service price
    Shows discounted price in invoice
    Records which offer was used

7. Validation Rules

Frontend:

    Services: Minimum 1 required
    Discount: 1-100% range
    Dates: End > Start, both required
    Price: >= 0

Backend:

    Same validations repeated
    Database constraints enforced
    Transaction rollback on error

8. User Experience Features

    Real-time Preview - See changes before saving
    Form Validation - Immediate feedback on errors
    Loading States - Spinners during API calls
    Success/Error Messages - Toast notifications
    Confirmation Dialogs - Prevent accidental deletions
    Auto-redirect - After successful save/update
    Default Values - Sensible defaults pre-filled

This system provides a complete, user-friendly way to manage student discount offers with multi-service support, flexible scheduling, and seamless integration with the billing system.
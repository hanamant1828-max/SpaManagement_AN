‚úÖ Action 1: Add Missing Staff Fields (2 lines)
Open: modules/billing/integrated_billing_views.py
Find this section (around line 535):
python# Update staff performance metrics - track total revenue generated
staff.total_revenue_generated = (staff.total_revenue_generated or 0.0) + service_amount
staff.total_clients_served = (staff.total_clients_served or 0) + 1
staff_updated_count += 1
Change it to:
python# Update staff performance metrics - track total revenue generated
staff.total_revenue_generated = (staff.total_revenue_generated or 0.0) + service_amount
staff.total_clients_served = (staff.total_clients_served or 0) + 1
staff.total_sales = (staff.total_sales or 0.0) + service_amount  # ‚Üê ADD THIS LINE
staff.last_service_performed = current_date  # ‚Üê ADD THIS LINE (use current_date which is already defined)
staff_updated_count += 1

‚úÖ Action 2: Enhanced Save Button JavaScript
In your HTML template (templates/integrated_billing.html), find and REPLACE the entire handleBillingFormSubmit function with this:
javascriptfunction handleBillingFormSubmit(event) {
    event.preventDefault();

    const form = event.target;
    const submitBtn = document.getElementById('saveInvoiceBtn');
    const clientId = form.querySelector('#client_id').value;
    
    // üîç Enhanced Validation
    if (!clientId) {
        showNotification('‚ö†Ô∏è Please select a customer before saving', 'warning', 5000);
        form.querySelector('#client_id').focus();
        form.querySelector('#client_id').scrollIntoView({ behavior: 'smooth', block: 'center' });
        return;
    }

    const selectedServices = Array.from(document.querySelectorAll('.service-row select[name="service_ids[]"]'))
        .filter(select => select.value).length;
    const selectedProducts = Array.from(document.querySelectorAll('.product-row select[name="product_ids[]"]'))
        .filter(select => select.value).length;

    if (selectedServices === 0 && selectedProducts === 0) {
        showNotification('‚ö†Ô∏è Please add at least one service or product', 'warning', 5000);
        return;
    }

    // Check if all services have staff assigned
    const servicesWithoutStaff = Array.from(document.querySelectorAll('.service-row')).filter(row => {
        const serviceSelect = row.querySelector('select[name="service_ids[]"]');
        const staffSelect = row.querySelector('select[name="staff_ids[]"]');
        return serviceSelect && serviceSelect.value && (!staffSelect || !staffSelect.value);
    });

    if (servicesWithoutStaff.length > 0) {
        showNotification('‚ö†Ô∏è Please assign staff for all services', 'warning', 5000);
        servicesWithoutStaff[0].querySelector('select[name="staff_ids[]"]').focus();
        return;
    }

    // üéØ Disable button and show progress
    submitBtn.disabled = true;
    submitBtn.classList.add('saving');
    
    // üìä Multi-stage progress indicator
    let stage = 0;
    const stages = [
        'Creating invoice...',
        'Applying packages...',
        'Updating bookings...',
        'Processing inventory...',
        'Finalizing...'
    ];
    
    const progressInterval = setInterval(() => {
        if (stage < stages.length) {
            submitBtn.querySelector('.loading-text').textContent = stages[stage];
            stage++;
        }
    }, 1200);

    // Collect form data
    const formData = new FormData(form);

    fetch('/integrated-billing/create-professional', {
        method: 'POST',
        body: formData
    })
    .then(response => {
        clearInterval(progressInterval);
        if (!response.ok) {
            return response.json().then(errorData => {
                throw new Error(errorData.message || `Server error: ${response.status}`);
            }).catch(() => {
                throw new Error(`Server error: ${response.status} ${response.statusText}`);
            });
        }
        return response.json();
    })
    .then(data => {
        if (data.success) {
            // ‚úÖ SUCCESS STATE
            submitBtn.classList.remove('saving');
            submitBtn.classList.add('saved');
            submitBtn.querySelector('.btn-success-state span').textContent = 'Saved Successfully!';

            // üéâ ENHANCED SUCCESS NOTIFICATION
            const customer = document.querySelector('#client_id option:checked')?.text || 'Customer';
            const successMessage = `
                ‚úÖ Invoice ${data.invoice_number} Created Successfully!

                üìã Summary:
                ‚Ä¢ Customer: ${customer}
                ‚Ä¢ Total: ‚Çπ${parseFloat(data.total_amount || 0).toFixed(2)}
                ‚Ä¢ Services: ${data.service_items_created || 0} items
                ‚Ä¢ Products: ${data.inventory_items_created || 0} items
                ${data.package_deductions_applied > 0 ? `\n‚Ä¢ Package Benefits: ${data.package_deductions_applied} applied` : ''}
                ${data.appointments_completed > 0 ? `\n‚Ä¢ Bookings Completed: ${data.appointments_completed}` : ''}
                ${data.staff_performance_updated > 0 ? `\n‚Ä¢ Staff Updated: ${data.staff_performance_updated}` : ''}
                
                Redirecting to invoice...
            `.trim();

            showNotification(successMessage, 'success', 5000);

            // üîÑ Redirect after success
            setTimeout(() => {
                window.location.href = `/integrated-billing/invoice/${data.invoice_id}`;
            }, 2000);
        } else {
            throw new Error(data.message || 'Failed to create invoice');
        }
    })
    .catch(error => {
        clearInterval(progressInterval);
        console.error('Billing Error:', error);

        // ‚ùå ERROR STATE - Reset button
        submitBtn.disabled = false;
        submitBtn.classList.remove('saving', 'saved');
        
        const errorMessage = `
            ‚ùå Failed to Save Invoice
            
            Error: ${error.message || 'Unknown error'}
            
            Please check:
            ‚úì All required fields are filled
            ‚úì Staff assigned to all services
            ‚úì Valid inventory quantities
            ‚úì Internet connection is stable
            
            Contact support if the problem persists.
        `.trim();

        showNotification(errorMessage, 'error', 10000);
    });
}

üé® Action 3: Add Enhanced Button CSS
In the <style> section of your HTML, add these styles:
css/* Enhanced Save Button States */
.btn-save-invoice {
    position: relative;
    overflow: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    min-width: 200px;
}

.btn-save-invoice:disabled {
    background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%) !important;
    cursor: not-allowed;
    opacity: 0.8;
}

.btn-save-invoice.saving {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%) !important;
    animation: savingPulse 1.5s ease-in-out infinite;
    box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
}

.btn-save-invoice.saved {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important;
    transform: scale(1.05);
    box-shadow: 0 0 25px rgba(16, 185, 129, 0.6);
}

@keyframes savingPulse {
    0%, 100% { 
        opacity: 1;
        box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
    }
    50% { 
        opacity: 0.85;
        box-shadow: 0 0 30px rgba(59, 130, 246, 0.7);
    }
}

/* Loading text animation */
.btn-save-invoice .loading-text {
    animation: fadeInText 0.5s ease;
    display: inline-block;
}

@keyframes fadeInText {
    from { opacity: 0; transform: translateY(-5px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Success checkmark animation */
.btn-save-invoice.saved .btn-success-state i {
    animation: checkmarkBounce 0.6s ease;
}

@keyframes checkmarkBounce {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.3); }
}

üß™ Testing Checklist
After implementing, test:

Create invoice ‚Üí Should show progress stages
Success ‚Üí Should display detailed summary with all counts
Error ‚Üí Should show helpful error message and reset button
Button states ‚Üí Disabled during save, success animation after
Staff update ‚Üí Check database that total_sales and last_service_performed are